---
sidebar: sidebar 
permalink: migration/shift-toolkit-settings.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary: Shift Toolkit で詳細設定を構成して、CredSSP 認証を管理し、ログ記録とデバッグを有効にし、REST API にアクセスし、移行ジョブの電子メール通知を設定します。 
---
= Shift Toolkitで詳細設定を構成する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Shift Toolkit で詳細設定を構成して、CredSSP 認証を管理し、ログ記録とデバッグを有効にし、REST API にアクセスし、移行ジョブの電子メール通知を設定します。

上部のツールバーの*設定*アイコンをクリックして、詳細設定にアクセスします。

image::shift-toolkit-250.png[Shift Toolkit ツールバーの設定アイコン]



== 資格情報セキュリティサービスプロバイダー (CredSSP)

Shift Toolkit は、Credential Security Service Provider (CredSSP) を使用して、変換プロセス中の資格情報の転送を管理します。  Shift サーバーは、変換中の VM のゲスト オペレーティング システム上でスクリプトを実行し、Shift サーバーから Hyper-V サーバーを経由してゲスト OS に「ダブルホップ」で資格情報を渡します。

image::shift-toolkit-251.png[CredSSP構成設定]



=== Shift サーバーを CredSSP クライアントとして構成する

詳細設定ウィザードは、Shift サーバーを CredSSP クライアントとして自動的に構成し、資格情報を Hyper-V サーバーに委任できるようにします。



==== 舞台裏

Shift Toolkit は次のコマンドとポリシー構成を実行して、自身をクライアントとして設定します。

*実行されたコマンド:*

* `Set-Item WSMan:\localhost\Client\TrustedHosts -Value "fqdn-of-hyper-v-host"`
* `Enable-WSManCredSSP -Role client -DelegateComputer "fqdn-of-hyper-v-host"`


*グループポリシーが設定されています:*

* コンピューターの構成 > 管理用テンプレート > システム > 資格情報の委任 > NTLMのみのサーバー認証で新しい資格情報の委任を許可する
+
このポリシーを有効にして追加 `wsman/fqdn-of-hyper-v-host`。





=== Hyper-V サーバーを CredSSP サーバーとして構成する

使用 `Enable-WSManCredSSP`Hyper-V サーバー上でコマンドレットを実行して、CredSSP サーバーとして構成し、Shift サーバーから資格情報を受信できるようにします。

.手順
. Shift Toolkit サーバーによって VM がプロビジョニングされる Hyper-V ホストで、管理者として Windows PowerShell セッションを開きます。
. 次のコマンドを実行します。
+
[listing]
----
Enable-PSRemoting
Enable-WSManCredSSP -Role server
----




== ログ記録とデバッグ

Shift Toolkit には、30 日間の保持期間を持つデフォルトのログ記録が含まれています。トラブルシューティングの目的で、サポートからのリクエストに応じてログをデバッグ モードに切り替えることができます。

image::shift-toolkit-252.png[ログ構成設定]



== 威勢のいい

詳細設定の Swagger ページでは、Shift Toolkit REST API と対話できます。

image::shift-toolkit-253.png[Swagger APIドキュメントインターフェース]

Shift Toolkit REST API は、移行、変換、自動化機能へのプログラムによるアクセスを提供します。  API は機能ワークフロー別に整理されており、特定のタスクに必要なリソースをすばやく見つけることができます。

image::shift-toolkit-254.png[APIリソースカテゴリ]



=== 認証とセットアップAPI

これらの API を使用して、Shift Toolkit サーバーへの接続を確立し、ユーザーを管理し、認証を構成します。

*セッション*

ユーザー認証を管理し、API リクエストの承認トークンを取得します。

* セッションを開始する
* セッションを検証する
* すべてのセッションIDを取得する
* セッションを終了する


*ユーザー*

ユーザー アカウントと権限を管理します。

* ユーザーを追加する
* すべてのユーザーを取得
* ユーザーパスワードの変更
* EULAに同意する


*CredSSP*

資格情報の委任用に資格情報セキュリティ サービス プロバイダーを構成します。

* CredSSPを有効にする
* CredSSPステータスを取得する


*コネクタ*

インフラストラクチャ コンポーネントへの接続を管理します。

* コネクタを追加する
* すべてのコネクタの詳細を取得する
* IDでコネクタの詳細を更新
* IDでコネクタの詳細を取得する


*テナント*

マルチテナント構成を管理します。

* テナントを追加する
* すべてのテナントを取得する




=== インフラストラクチャ管理API

これらの API を使用して、ソース環境とターゲット環境を構成および検出します。

*サイト*

移行サイトとそれに関連する仮想環境およびストレージ環境を管理します。

* サイト数を取得する
* サイトの詳細をすべて取得
* サイトを追加する
* IDでサイトの詳細を取得する
* IDでサイトを削除する
* サイトに仮想環境を追加する
* サイトにストレージ環境を追加する
* サイトの仮想環境の詳細を取得する
* サイトの仮想環境の詳細を更新する
* サイトの仮想環境の詳細を削除する
* サイトのストレージ環境の詳細を取得する
* サイトのストレージ環境の詳細を更新する
* サイトのストレージ環境の詳細を削除する


*発見*

ソース サイトとターゲット サイトの VM とリソースを検出し、インベントリを作成します。

* ソースサイトを発見
* ソースサイトのすべての検出要求を取得する
* ターゲットサイトを発見
* 対象サイトのすべての検出要求を取得する
* ID でソース サイトの検出手順を取得する
* ID でターゲット サイトの検出手順を取得します




=== VMおよびリソース管理API

これらの API を使用して、移行用の VM とリソースのインベントリを作成、整理、管理します。

*VM*

仮想マシンのクエリと管理:

* ソース内のサイトと仮想環境のVMを取得する
* サイトと仮想環境の保護されていない VM を取得する
* VM数を取得する
* 保護されているVMの数を取得する


*リソース*

リソースの使用率と可用性を表示します。

* サイトと仮想環境のリソースの詳細を取得する
* ソースサイトのリソース数を取得する


*リソースグループ*

移行のために VM を保護グループに編成します。

* 保護グループの数を取得する
* すべての保護グループの詳細を取得する
* 保護グループを追加する
* IDで保護グループの詳細を取得する
* ID で保護グループを削除する
* ID による保護グループの詳細の更新
* ID で保護グループの VM を取得する
* 保護グループを含むブループリントを取得する




=== 移行および回復API

これらの API を使用して、移行の実行、コンプライアンスの監視、回復操作の管理を行います。

*設計図*

移行ブループリントを定義および管理します。

* 設計図の数を取得する
* すべての設計図の詳細を取得する
* ブループリントを追加する
* IDで設計図の詳細を取得する
* IDでブループリントを削除
* IDの設計図の詳細を更新
* ブループリントのVMを取得する
* ブループリント内に存在するVMの電源ステータスを取得する


*コンプライアンス*

移行前に準備状況と互換性を確認します。

* ブループリントのコンプライアンスチェック結果を取得する
* ブループリントのコンプライアンス チェックの最終ステータスを取得する
* ブループリントのオンデマンドコンプライアンスチェックを追加する


*実行*

移行および変換ジョブの実行を監視します。

* すべての実行の詳細を取得する
* 進行中の実行の詳細を取得する
* 実行回数を取得する
* 進行中の実行の数を取得する
* 実行IDのステップを取得する


*回復*

移行および回復操作を実行および管理します。

* ブループリントの新しい実行リクエストを追加する
* ブループリントの実行の再試行リクエストを追加する
* すべてのブループリントの実行ステータスを取得する
* ブループリントIDの実行ステータスを取得する




=== 自動化API

これらの API を使用して、Shift Toolkit の機能を拡張および自動化します。

*スクリプトブロック*

自動化スクリプトにアクセスして実行します。

* すべてのスクリプトのメタデータを取得する
* IDでスクリプトのメタデータを取得する
* すべての更新メタデータを取得する
* スクリプトの実行




== スクリプトブロックと自動化

Shift Toolkit 内のスクリプト ブロックには、内部および外部 API を使用して機能を自動化、統合、開発するのに役立つサンプル コードが用意されています。コード サンプル セクションで、Shift Toolkit 自動化チームとコミュニティ メンバーによって作成されたサンプルを参照してダウンロードします。これらのサンプルを使用して、自動化、管理、または統合タスクを開始します。

image::shift-toolkit-255.png[スクリプトブロックインターフェース]

image::shift-toolkit-256.png[利用可能なコードサンプル]

次の例は、Shift Toolkit UI 内で特定のジョブを削除する PowerShell スクリプトを示しています。この機能は標準ワークフローでは公開されませんが、スクリプト ブロックを使用して実現できます。このスクリプトは、簡単にダウンロードして実行できるバッチ スクリプトとしても利用できます。

image::shift-toolkit-257.png[ジョブ削除用の PowerShell スクリプトの例]

スクリプト ブロックの目的は、Shift Toolkit API とそれぞれのハイパーバイザーで公開されている API を使用して、特定のハイパーバイザーでの 0 日目および進行中の操作のサンプル スクリプトを提供することです。

スクリプト ブロックの目的は、Shift Toolkit API とそれぞれのハイパーバイザーで公開されている API を使用して、特定のハイパーバイザーでの 0 日目および進行中の操作のサンプル スクリプトを提供することです。



== メール通知とアラート

検出、変換、または移行ジョブに関するアラートを指定された受信者に送信するように電子メール通知を構成します。  UI 通知 (インターフェース内のアラート) も利用可能で、7 日間保存されます。

[設定] > [プラットフォーム設定] > [電子メール構成] から電子メール通知設定にアクセスします。

.手順
. Shift Toolkit UI にログインします。
. [設定] > [プラットフォーム設定]に移動します。
. 電子メール通知を選択し、SMTP の詳細を更新します。
+
** SMTPサーバーアドレス
** ポート
** ユーザー名
** パスワード


. 受信者フィールドを更新し、利用可能なカテゴリからイベントを選択します。
. *適用*をクリックします。


image::shift-toolkit-258.png[電子メール通知の構成設定]

スクリーンショットには、各通知カテゴリとイベントの内訳が表示されます。


NOTE: このリリースでは、電子メール通知には基本的な SMTP 認証と SendGrid が使用されます。将来のリリースでは最新の認証がサポートされる予定です。


NOTE: このリリースでは、電子メール通知には基本的な SMTP 認証と SendGrid が使用されます。将来のリリースでは最新の認証がサポートされる予定です。



== 中止と元に戻す機能

Shift Toolkit には、ワークフロー内のどのステップでも実行中のジョブをキャンセルするオプションが用意されています。ジョブがキャンセルされると、以下を含むすべての孤立したコンポーネントが自動的にクリーンアップされます。

* ハイパーバイザー上のVMの電源がオンになっている場合はオフにする
* 適切なqtreeからディスクエントリを削除する
* 永続ボリュームクレーム（PVC）の削除


Shift Toolkit はソース VM を一切変更しないため、ロールバックは簡単で、ソース VM の電源をオンにするだけです。その他のロールバックアクションは必要ありません。
