---
sidebar: sidebar 
permalink: migration/migrate-vms-to-ec2-fsxn-arch.html 
keywords: netapp, vmware, amazon, ec2, fsxn, migration, iscsi, 
summary: 'この技術レポートでは、Cirrus Migrate Cloud (CMC) の MigrateOps の「コードとしてのデータモビリティ」機能を使用して、オンプレミスの VMware vSphere VM を、FSx ONTAP iSCSI LUN 上にデータディスクが配置された Amazon EC2 インスタンスに移行する方法について説明します。' 
---
= VM を Amazon EC2 に移行するためのアーキテクチャと要件
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Amazon FSx for NetApp ONTAPを使用して VM を Amazon EC2 に移行するためのアーキテクチャと主な前提条件について説明します。



== 高レベルアーキテクチャ

以下の図は、CMC MigrateOps を使用して VMware 上の仮想マシン ディスク (VMDK) データを AWS に移行する高レベル アーキテクチャを示しています。

image:migrate-ec2-fsxn-001.png["FSx ONTAPアーキテクチャ図を使用して VM を Amazon EC2 に移行する"]



== Amazon EC2 と FSx ONTAP iSCSI を使用して VMware VM を AWS に移行する方法



=== 前提条件

ウォークスルーの手順を開始する前に、次の前提条件が満たされていることを確認してください。

*AWS の場合*

* AWS アカウント。これには、サブネット、VPC セットアップ、ルーティング テーブル、セキュリティ ルールの移行、セキュリティ グループ、およびロード バランシングなどのネットワークのその他の要件に対する権限が含まれます。あらゆる移行と同様に、ネットワークに最も多くの労力と考慮を払う必要があります。
* FSx ONTAPと Amazon EC2 インスタンスの両方をプロビジョニングできる適切な IAM ロール。
* ルート テーブルとセキュリティ グループは FSx ONTAPと通信できます。
* オンプレミスのデータセンターから AWS への安全なデータ転送を可能にするには、適切なセキュリティ グループに受信ルールを追加します (詳細については以下を参照)。
* パブリックインターネットドメイン名を解決できる有効な DNS。
* DNS 解決が機能しており、ホスト名を解決できることを確認します。
* 最適なパフォーマンスと適切なサイズ設定のために、ソース環境のパフォーマンス データを使用して FSx ONTAPストレージのサイズを適切なサイズに設定します。
* 各 MigrateOps セッションでは 1 つの EIP が使用されるため、並列処理を増やすには EIP のクォータを増やす必要があります。デフォルトの EIP クォータは 5 であることに注意してください。
* (Active Directory ベースのワークロードを移行する場合) Amazon EC2 上の Windows Active Directory ドメイン。


*Cirrus Migrate Cloud の場合*

* Cirrus Data Cloudアカウントlink:http://cloud.cirrusdata.com/["cloud.cirrusdata.com"]CMC を使用する前に作成する必要があります。  CDN、Cirrus Data エンドポイント、およびソフトウェア リポジトリとの HTTPS 経由の送信通信を許可する必要があります。
* HTTPS プロトコル (ポート 443) 経由で Cirrus Data Cloud サービスとの通信 (送信) を許可します。
* ホストを CMC プロジェクトで管理するには、展開された CMC ソフトウェアが Cirrus Data Cloud への一方向の送信 TCP 接続を開始する必要があります。
* TCP プロトコル、ポート 443 による portal-gateway.cloud.cirrusdata.com (現在は 208.67.222.222) へのアクセスを許可します。
* バイナリ データ ペイロード (アプリケーション/オクテット ストリーム) を含む HTTP POST リクエスト (HTTPS 接続経由) を許可します。これはファイルのアップロードに似ています。
* portal-gateway.cloud.cirrusdata.com が DNS (または OS ホスト ファイル経由) で解決可能であることを確認します。
* 製品インスタンスによるアウトバウンド接続を禁止する厳格なルールがある場合は、アウトバウンド 443 接続が単一のセキュリティ保護された非本番環境ホストから行われる場合に、CMC の「管理リレー」機能を使用できます。


*注*: ストレージ データは Cirrus Data Cloud エンドポイントに送信されることはありません。管理メタデータのみが送信され、実際のホスト名、ボリューム名、ネットワーク IP が含まれないようにオプションでマスクできます。

オンプレミスのストレージリポジトリから AWS にデータを移行する場合、MigrateOps はホスト間 (H2H) 接続の管理を自動化します。これらは、CMC がリモート移行を容易にするために使用する、最適化された一方向の TCP ベースのネットワーク接続です。このプロセスは常時圧縮と暗号化を特徴としており、データの性質に応じてトラフィックの量を最大 8 倍削減できます。

*注*: CMC は、移行フェーズ全体を通じて実稼働データや I/O が実稼働ネットワークから出ないように設計されます。その結果、送信元ホストと宛先ホスト間の直接接続が必要になります。
