---
sidebar: sidebar 
permalink: vmware/vmw-vcf-scv-viwld.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, vvol, vvols, array, ontap tools, otv, sddc, scv, snapcenter, plug-in 
summary:  
---
= VMware vSphere 用のSnapCenterプラグインを使用して VCF ワークロード ドメインを保護する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このユースケースでは、VMware vSphere 用のSnapCenterプラグインを使用して、VMware Cloud Foundation (VCF) ワークロード ドメイン内の VM とデータストアをバックアップおよび復元する手順について説明します。この手順では、VMware vSphere 用のSnapCenterプラグインの展開、ストレージ システムの追加、バックアップ ポリシーの作成、VM およびファイルの復元の実行についてまとめています。

このソリューションでは、VMFS データストアのストレージ プロトコルとして *iSCSI* が使用されます。



== シナリオの概要

このシナリオでは、次の大まかな手順について説明します。

* VI ワークロード ドメインにSnapCenter Plug-in for VMware vSphereを展開します。
* SCV にストレージ システムを追加します。
* SCV でバックアップ ポリシーを作成します。
* SCV にリソース グループを作成します。
* SCV を使用して、データストアまたは特定の VM をバックアップします。
* SCV を使用して、VM をクラスター内の別の場所に復元します。
* SCV を使用してファイルを Windows ファイル システムに復元します。




== 前提条件

このシナリオには、次のコンポーネントと構成が必要です。

* ワークロード ドメイン クラスタに割り当てられた iSCSI VMFS データストアを備えたONTAP ASAストレージ システム。
* SnapMirrorを使用してセカンダリ バックアップを受信するように構成されたセカンダリONTAPストレージ システム。
* VCF 管理ドメインの展開が完了し、vSphere クライアントにアクセスできるようになりました。
* VI ワークロード ドメインは以前にデプロイされています。
* 仮想マシンは、SCV が保護するように指定されているクラスター上に存在します。


iSCSI VMFSデータストアを補助ストレージとして構成する方法については、以下を参照してください。link:vmw-vcf-mgmt-supplemental-iscsi.html["*VMware 向けONTAPツールを使用した管理ドメインの補助ストレージとしての iSCSI*"]このドキュメントでは。  OTV を使用してデータストアを展開するプロセスは、管理ドメインとワークロード ドメインで同じです。


TIP: SCV で取得したバックアップをセカンダリ ストレージに複製するだけでなく、 NetApp Backup and Recovery for VMs を使用して、3 大クラウド プロバイダーのいずれかのオブジェクト ストレージにデータのオフサイト コピーを作成することもできます。詳細については、このオファーを参照してください。link:https://docs.netapp.com/us-en/data-services-backup-recovery/index.html["NetApp Backup and Recoveryのドキュメント"] 。

image:vmware-vcf-asa-108.png["3-2-1バックアップ戦略"]



== 展開手順

SnapCenterプラグインを展開し、それを使用してバックアップを作成し、VM とデータストアを復元するには、次の手順を実行します。



=== SCV を導入して使用し、VI ワークロード ドメイン内のデータを保護する

SCV を展開、構成、使用して VI ワークロード ドメイン内のデータを保護するには、次の手順を実行します。

.SnapCenter Plug-in for VMware vSphereの導入
[%collapsible%open]
====
SnapCenterプラグインは VCF 管理ドメインでホストされますが、VI ワークロード ドメインの vCenter に登録されます。各 vCenter インスタンスには 1 つの SCV インスタンスが必要です。また、ワークロード ドメインには、単一の vCenter インスタンスによって管理される複数のクラスターを含めることができることに注意してください。

SCV を VI ワークロード ドメインにデプロイするには、vCenter クライアントから次の手順を実行します。

. NetAppサポート サイトのダウンロード エリアから SCV 展開用の OVA ファイルをダウンロードします。link:https://mysupport.netapp.com/site/products/all/details/scv/downloads-tab["*ここ*"] 。
. 管理ドメイン vCenter Client から、*OVF テンプレートのデプロイ...* を選択します。
+
image:vmware-vcf-asa-046.png["OVF テンプレートをデプロイします..."]

+
{nbsp}

. *OVF テンプレートのデプロイ* ウィザードで、*ローカル ファイル* ラジオ ボタンをクリックし、以前にダウンロードした OVF テンプレートをアップロードすることを選択します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-047.png["OVFテンプレートを選択"]

+
{nbsp}

. *名前とフォルダーの選択*ページで、SCV データ ブローカー VM の名前と管理ドメイン上のフォルダーを指定します。続行するには、[次へ] をクリックします。
. *コンピューティング リソースの選択* ページで、VM をインストールする管理ドメイン クラスターまたはクラスター内の特定の ESXi ホストを選択します。
. *詳細の確認*ページで OVF テンプレートに関する情報を確認し、*ライセンス契約*ページでライセンス条項に同意します。
. *ストレージの選択*ページで、VM をインストールするデータストアを選択し、*仮想ディスク フォーマット*と*VM ストレージ ポリシー*を選択します。このソリューションでは、このドキュメントの別のセクションで以前に展開されたように、 ONTAPストレージ システムにある iSCSI VMFS データストアに VM がインストールされます。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-048.png["OVFテンプレートを選択"]

+
{nbsp}

. *ネットワークの選択* ページで、ワークロード ドメイン vCenter アプライアンスおよびプライマリとセカンダリの両方のONTAPストレージ システムと通信できる管理ネットワークを選択します。
+
image:vmware-vcf-asa-049.png["管理ネットワークを選択"]

+
{nbsp}

. *テンプレートのカスタマイズ*ページで、デプロイメントに必要なすべての情報を入力します。
+
** ワークロード ドメイン vCenter アプライアンスの FQDN または IP、および資格情報。
** SCV 管理アカウントの資格情報。
** SCV メンテナンス アカウントの資格情報。
** IPv4 ネットワーク プロパティの詳細 (IPv6 も使用できます)。
** 日付と時刻の設定。
+
続行するには、[次へ] をクリックします。

+
image:vmware-vcf-asa-050.png["管理ネットワークを選択"]

+
image:vmware-vcf-asa-051.png["管理ネットワークを選択"]

+
image:vmware-vcf-asa-052.png["管理ネットワークを選択"]

+
{nbsp}



. 最後に、「*完了準備完了ページ*」ですべての設定を確認し、「完了」をクリックしてデプロイを開始します。


====
.SCVにストレージシステムを追加する
[%collapsible%open]
====
SnapCenterプラグインをインストールしたら、次の手順を実行してストレージ システムを SCV に追加します。

. SCV には、vSphere Client のメイン メニューからアクセスできます。
+
image:vmware-vcf-asa-053.png["SnapCenterプラグインを開く"]

+
{nbsp}

. SCV UI インターフェイスの上部で、保護する vSphere クラスターに一致する正しい SCV インスタンスを選択します。
+
image:vmware-vcf-asa-054.png["正しいインスタンスを選択してください"]

+
{nbsp}

. 左側のメニューの「ストレージ システム」に移動し、「追加」をクリックして開始します。
+
image:vmware-vcf-asa-055.png["新しいストレージシステムを追加する"]

+
{nbsp}

. *ストレージ システムの追加* フォームで、追加するONTAPストレージ システムの IP アドレスと資格情報を入力し、*追加* をクリックしてアクションを完了します。
+
image:vmware-vcf-asa-056.png["ストレージシステムの資格情報を提供する"]

+
{nbsp}

. セカンダリ バックアップ ターゲットとして使用されるシステムを含む、管理する追加のストレージ システムに対してこの手順を繰り返します。


====
.SCVでバックアップポリシーを構成する
[%collapsible%open]
====
SCVバックアップポリシーの作成の詳細については、以下を参照してください。link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/scpivs44_create_backup_policies_for_vms_and_datastores.html["VMとデータストアのバックアップ ポリシーの作成"] 。

新しいバックアップ ポリシーを作成するには、次の手順を実行します。

. 左側のメニューから*ポリシー*を選択し、*作成*をクリックして開始します。
+
image:vmware-vcf-asa-057.png["新しいポリシーを作成する"]

+
{nbsp}

. *新しいバックアップ ポリシー* フォームで、ポリシーの *名前* と *説明*、バックアップを実行する *頻度*、およびバックアップを保持する期間を指定する *保持* 期間を入力します。
+
*ロック期間* により、 ONTAP SnapLock機能を使用して改ざん防止スナップショットを作成し、ロック期間を構成することができます。

+
*レプリケーション*の場合、 ONTAPストレージ ボリュームの基礎となるSnapMirrorまたはSnapVault関係を更新する場合に選択します。

+

TIP: SnapMirrorとSnapVaultレプリケーションは、どちらもONTAP SnapMirrorテクノロジを使用してストレージ ボリュームをセカンダリ ストレージ システムに非同期的に複製し、保護とセキュリティを強化するという点で似ています。  SnapMirror関係の場合、SCV バックアップ ポリシーで指定された保持スケジュールによって、プライマリ ボリュームとセカンダリ ボリュームの両方の保持が管理されます。 SnapVault関係を使用すると、より長期の保持スケジュールや異なる保持スケジュールのために、セカンダリ ストレージ システムで個別の保持スケジュールを設定できます。この場合、スナップショット ラベルは SCV バックアップ ポリシーとセカンダリ ボリュームに関連付けられたポリシーで指定され、独立した保持スケジュールを適用するボリュームを識別します。

+
追加の詳細オプションを選択し、「*追加*」をクリックしてポリシーを作成します。

+
image:vmware-vcf-asa-058.png["ポリシーの詳細を入力してください"]



====
.SCVでリソースグループを作成する
[%collapsible%open]
====
SCVリソースグループの作成の詳細については、以下を参照してください。link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/scpivs44_create_resource_groups_for_vms_and_datastores.html["リソース グループの作成"] 。

新しいリソース グループを作成するには、次の手順を実行します。

. 左側のメニューから*リソース グループ*を選択し、*作成*をクリックして開始します。
+
image:vmware-vcf-asa-059.png["新しいリソースグループを作成する"]

+
{nbsp}

. *一般情報と通知*ページで、リソース グループの名前、通知設定、スナップショットの命名に関する追加オプションを指定します。
. *リソース* ページで、リソース グループ内で保護するデータストアと VM を選択します。続行するには、[次へ] をクリックします。
+

TIP: 特定の仮想マシンのみを選択した場合でも、データストア全体が常にバックアップされます。これは、 ONTAP がデータストアをホストしているボリュームのスナップショットを取得するためです。ただし、バックアップ対象として特定の VM のみを選択すると、それらの VM のみに復元する機能が制限されることに注意してください。

+
image:vmware-vcf-asa-060.png["バックアップするリソースを選択"]

+
{nbsp}

. *スパニング ディスク* ページで、複数のデータストアにまたがる VMDK を持つ VM を処理する方法のオプションを選択します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-061.png["スパンデータストアオプションを選択"]

+
{nbsp}

. *ポリシー* ページで、このリソース グループで使用される以前に作成したポリシーまたは複数のポリシーを選択します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-062.png["ポリシーを選択"]

+
{nbsp}

. *スケジュール* ページで、繰り返しと時刻を設定して、バックアップを実行するタイミングを確立します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-063.png["スケジュールを選択"]

+
{nbsp}

. 最後に*概要*を確認し、*完了*をクリックしてリソース グループを作成します。
+
image:vmware-vcf-asa-064.png["概要を確認してリソース グループを作成する"]

+
{nbsp}

. リソース グループを作成したら、[今すぐ実行] ボタンをクリックして最初のバックアップを実行します。
+
image:vmware-vcf-asa-065.png["概要を確認してリソース グループを作成する"]

+
{nbsp}

. *ダッシュボード* に移動し、*最近のジョブアクティビティ* の下にある *ジョブ ID* の横にある番号をクリックしてジョブモニターを開き、実行中のジョブの進行状況を表示します。
+
image:vmware-vcf-asa-066.png["バックアップジョブの進行状況を表示する"]



====


==== SCV を使用して VM、VMDK、およびファイルを復元する

SnapCenterプラグインを使用すると、プライマリ バックアップまたはセカンダリ バックアップから VM、VMDK、ファイル、フォルダーを復元できます。

VM は、元のホスト、同じ vCenter Server 内の代替ホスト、または同じ vCenter またはリンク モードの任意の vCenter によって管理される代替 ESXi ホストに復元できます。

vVol VM は元のホストに復元できます。

従来の VM の VMDK は、元のデータストアまたは代替データストアに復元できます。

vVol VM 内の VMDK は元のデータストアに復元できます。

ゲスト ファイル復元セッション内の個々のファイルとフォルダーを復元できます。このセッションでは、仮想ディスクのバックアップ コピーが添付され、選択したファイルまたはフォルダーが復元されます。

VM、VMDK、または個々のフォルダーを復元するには、次の手順を実行します。

.SnapCenterプラグインを使用してVMを復元する
[%collapsible%open]
====
SCV を使用して VM を復元するには、次の手順を実行します。

. vSphere クライアントで復元する VM に移動し、右クリックして * SnapCenter Plug-in for VMware vSphere* に移動します。サブメニューから*復元*を選択します。
+
image:vmware-vcf-asa-067.png["VMを復元するには選択してください"]

+

TIP: 別の方法としては、インベントリ内のデータストアに移動し、[構成] タブで [SnapCenter Plug-in for VMware vSphere] > [バックアップ] に移動します。選択したバックアップから、復元する VM を選択します。

+
image:vmware-vcf-asa-068.png["データストアからバックアップをナビゲートします"]

+
{nbsp}

. *復元*ウィザードで、使用するバックアップを選択します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-069.png["使用するバックアップを選択"]

+
{nbsp}

. *範囲の選択*ページで、すべての必須フィールドに入力します。
+
** *復元範囲* - 仮想マシン全体を復元する場合に選択します。
** *VM を再起動* - 復元後に VM を起動するかどうかを選択します。
** *復元場所* - 元の場所に復元するか、別の場所に復元するかを選択します。別の場所を選択するときは、各フィールドからオプションを選択します。
+
*** *宛先 vCenter Server* - ローカル vCenter またはリンク モードの代替 vCenter
*** *宛先ESXiホスト*
*** *ネットワーク*
*** *復元後のVM名*
*** *データストアを選択:*
+
image:vmware-vcf-asa-070.png["復元範囲オプションを選択"]

+
{nbsp}

+
続行するには、[次へ] をクリックします。





. *場所の選択*ページで、プライマリまたはセカンダリのONTAPストレージ システムから VM を復元することを選択します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-071.png["保存場所を選択"]

+
{nbsp}

. 最後に、*概要*を確認し、「完了」をクリックして復元ジョブを開始します。
+
image:vmware-vcf-asa-072.png["[完了] をクリックして復元ジョブを開始します"]

+
{nbsp}

. 復元ジョブの進行状況は、vSphere Client の *最近のタスク* ペインと SCV のジョブ モニターから監視できます。
+
image:vmware-vcf-asa-073.png["復元ジョブを監視する"]



====
.SnapCenterプラグインを使用してVMDKを復元する
[%collapsible%open]
====
ONTAPツールを使用すると、VMDK を元の場所に完全に復元したり、VMDK を新しいディスクとしてホスト システムに接続したりすることができます。このシナリオでは、ファイル システムにアクセスするために、VMDK が Windows ホストに接続されます。

バックアップから VMDK をアタッチするには、次の手順を実行します。

. vSphere Client で VM に移動し、[アクション] メニューから [SnapCenter Plug-in for VMware vSphere] > [仮想ディスクの接続] を選択します。
+
image:vmware-vcf-asa-080.png["仮想ディスクの接続を選択"]

+
{nbsp}

. *仮想ディスクの接続*ウィザードで、使用するバックアップ インスタンスと接続する特定の VMDK を選択します。
+
image:vmware-vcf-asa-081.png["仮想ディスクの接続設定を選択"]

+

TIP: フィルター オプションを使用すると、バックアップを検索したり、プライマリ ストレージ システムとセカンダリ ストレージ システムの両方からのバックアップを表示したりできます。

+
image:vmware-vcf-asa-082.png["仮想ディスクフィルターを添付する"]

+
{nbsp}

. すべてのオプションを選択したら、[*Attach*] ボタンをクリックして復元プロセスを開始し、VMDK をホストに接続します。
. アタッチ手順が完了すると、ホスト システムの OS からディスクにアクセスできるようになります。この場合、SCV は NTFS ファイル システムを備えたディスクを Windows SQL Server の E: ドライブに接続し、ファイル システム上の SQL データベース ファイルはファイル エクスプローラーからアクセスできるようになります。
+
image:vmware-vcf-asa-083.png["Windowsファイルシステムにアクセスする"]



====
.SnapCenterプラグインを使用したゲストファイルシステムの復元
[%collapsible%open]
====
ONTAPツールは、Windows Server OS 上の VMDK からのゲスト ファイル システムの復元機能を備えています。これは、 SnapCenterプラグイン インターフェースから集中的に実行されます。

詳細については、link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/scpivs44_restore_guest_files_and_folders_overview.html["ゲスト ファイルとフォルダの復元"] SCV ドキュメント サイト。

Windows システムのゲスト ファイル システムの復元を実行するには、次の手順を実行します。

. 最初のステップは、Windows ホスト システムへのアクセスを提供するための実行資格情報を作成することです。  vSphere Client で CSV プラグイン インターフェイスに移動し、メイン メニューの *ゲスト ファイルのリストア* をクリックします。
+
image:vmware-vcf-asa-084.png["ゲストファイルの復元を開く"]

+
{nbsp}

. *[実行資格情報] の下にある *+* アイコンをクリックして、[実行資格情報] ウィンドウを開きます。
. 資格情報レコードの名前、Windows システムの管理者のユーザー名とパスワードを入力し、[VM の選択] ボタンをクリックして、復元に使用するオプションの Proxy VM を選択します。image:vmware-vcf-asa-085.png["実行資格情報ウィンドウ"]
+
{nbsp}

. プロキシ VM ページで VM の名前を指定し、ESXi ホストまたは名前で検索して VM を見つけます。選択したら、[保存] をクリックします。
+
image:vmware-vcf-asa-086.png["プロキシVMページでVMを探す"]

+
{nbsp}

. *Run As Credentials* ウィンドウでもう一度 *Save* をクリックして、レコードの保存を完了します。
. 次に、インベントリ内の VM に移動します。  *[アクション]* メニューから、または VM を右クリックして、* [SnapCenter Plug-in for VMware vSphere] > [ゲスト ファイルのリストア]* を選択します。
+
image:vmware-vcf-asa-087.png["ゲストファイル復元ウィザードを開く"]

+
{nbsp}

. *ゲスト ファイルの復元* ウィザードの *復元範囲* ページで、復元元のバックアップ、特定の VMDK、および VMDK を復元する場所 (プライマリまたはセカンダリ) を選択します。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-088.png["ゲストファイルの復元範囲"]

+
{nbsp}

. *ゲストの詳細*ページで、復元に*ゲスト VM* を使用するか、*ゲスト ファイル復元プロキシ VM* を使用するかを選択します。また、必要に応じて、ここで電子メール通知設定を入力してください。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-089.png["ゲストファイルの詳細"]

+
{nbsp}

. 最後に、[*概要*] ページを確認し、[*完了*] をクリックしてゲスト ファイル システムの復元セッションを開始します。
. SnapCenterプラグイン インターフェイスに戻り、もう一度 *ゲスト ファイル リストア* に移動し、*ゲスト セッション モニター* で実行中のセッションを表示します。続行するには、「*ファイルの参照*」の下のアイコンをクリックします。
+
image:vmware-vcf-asa-090.png["ゲストセッションモニター"]

+
{nbsp}

. *ゲスト ファイルの参照* ウィザードで、復元するフォルダーまたはファイルと、復元先のファイル システムの場所を選択します。最後に、「*復元*」をクリックして、「*復元*」プロセスを開始します。
+
image:vmware-vcf-asa-091.png["ゲストファイル参照1"]

+
image:vmware-vcf-asa-092.png["ゲストファイル参照2"]

+
{nbsp}

. リストア ジョブは、vSphere Client のタスク ペインから監視できます。


====


== 追加情報

VCFの設定方法については、以下を参照してください。 https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware Cloud Foundation ドキュメント"] 。

ONTAPストレージシステムの構成については、 https://docs.netapp.com/us-en/ontap["ONTAP 9ドキュメント"]中心。

SnapCenter Plug-in for VMware vSphereの使用については、 https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["SnapCenter Plug-in for VMware vSphereのドキュメント"] 。
