---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nvme.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= VIワークロードドメインに補助ストレージとしてNVMe over TCPを追加する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このユースケースでは、 ONTAP Tools for VMware を使用して、NVMe over TCP (NVMe/TCP) を VMware Cloud Foundation (VCF) 仮想インフラストラクチャ (VI) ワークロード ドメインの補助ストレージとして構成する手順について説明します。この手順では、NVMe/TCP 対応のストレージ仮想マシン (SVM) のセットアップ、NVMe 名前空間の作成、ESXi ホスト ネットワークの構成、および VMFS データストアの展開についてまとめています。



== NVMe over TCPの利点

*高性能:* 低レイテンシと高データ転送速度で優れたパフォーマンスを実現します。これは、要求の厳しいアプリケーションや大規模なデータ操作にとって非常に重要です。

*スケーラビリティ:* スケーラブルな構成をサポートし、IT 管理者はデータ要件の増大に応じてインフラストラクチャをシームレスに拡張できます。

*コスト効率が高い:* 標準のイーサネット スイッチ上で実行され、TCP データグラム内にカプセル化されます。実装に特別な機器は必要ありません。

NVMeの利点の詳細については、以下を参照してください。 https://www.netapp.com/data-storage/nvme/what-is-nvme/["NVME とは何ですか?"]



== シナリオの概要

このシナリオでは、次の大まかな手順について説明します。

* NVMe/TCP トラフィック用の論理インターフェイス (LIF) を備えたストレージ仮想マシン (SVM) を作成します。
* VI ワークロード ドメイン上の iSCSI ネットワーク用の分散ポート グループを作成します。
* VI ワークロード ドメインの ESXi ホスト上に iSCSI 用の vmkernel アダプタを作成します。
* ESXi ホストに NVMe/TCP アダプターを追加します。
* NVMe/TCP データストアをデプロイします。




== 前提条件

このシナリオには、次のコンポーネントと構成が必要です。

* ストレージ トラフィック専用のイーサネット スイッチ上に物理データ ポートを備えたONTAP AFFまたはASAストレージ システム。
* VCF 管理ドメインの展開が完了し、vSphere クライアントにアクセスできるようになりました。
* VI ワークロード ドメインは以前にデプロイされています。


NetApp は、NVMe/TCP に完全に冗長化されたネットワーク設計を推奨しています。次の図は、ストレージ システム、スイッチ、ネットワーク アダプタ、およびホスト システムにフォールト トレランスを提供する冗長構成の例を示しています。  NetAppを参照してくださいlink:https://docs.netapp.com/us-en/ontap/san-config/index.html["SAN構成に関するリファレンス"]追加情報については。

image:vmware-vcf-asa-074.png["NVMe-tcp ネットワーク設計"]

複数のパスにわたるマルチパスとフェイルオーバーのために、 NetApp、NVMe/TCP 構成のすべての SVM に対して、個別のイーサネット ネットワーク内のストレージ ノードごとに少なくとも 2 つの LIF を用意することを推奨しています。

このドキュメントでは、新しい SVM を作成し、IP アドレス情報を指定して NVMe/TCP トラフィック用の複数の LIF を作成するプロセスについて説明します。既存のSVMに新しいLIFを追加するには、link:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIF（ネットワーク インターフェイス）の作成"] 。

ONTAPストレージシステムのNVMe設計に関する考慮事項の詳細については、以下を参照してください。link:https://docs.netapp.com/us-en/ontap/nvme/support-limitations.html["NVMeの構成、サポート、制限事項"] 。



== 展開手順

NVMe/TCP を使用して VCF ワークロード ドメインに VMFS データストアを作成するには、次の手順を実行します。



=== ONTAPストレージ システムに SVM、LIF、NVMe 名前空間を作成する

次の手順はONTAP System Manager で実行されます。

.ストレージVMとLIFを作成する
[%collapsible%open]
====
NVMe/TCP トラフィック用の複数の LIF とともに SVM を作成するには、次の手順を実行します。

. ONTAP System Manager から、左側のメニューの *Storage VMs* に移動し、*+ Add* をクリックして開始します。
+
image:vmware-vcf-asa-001.png["+追加をクリックしてSVMの作成を開始します"]

+
{nbsp}

. *ストレージ VM の追加* ウィザードで、SVM の *名前* を入力し、*IP スペース* を選択して、*アクセス プロトコル* の下にある *NVMe* タブをクリックし、*NVMe/TCP を有効にする* チェックボックスをオンにします。
+
image:vmware-vcf-asa-075.png["ストレージVMの追加ウィザード - NVMe/TCPを有効にする"]

+
{nbsp}

. *ネットワーク インターフェイス* セクションで、最初の LIF の *IP アドレス*、*サブネット マスク*、および *ブロードキャスト ドメインとポート* を入力します。後続の LIF については、チェックボックスを有効にして、残りのすべての LIF で共通の設定を使用するか、個別の設定を使用するかを選択できます。
+

NOTE: 複数のパスにわたるマルチパスとフェイルオーバーのために、 NetApp、NVMe/TCP 構成のすべての SVM に対して、個別のイーサネット ネットワーク内のストレージ ノードごとに少なくとも 2 つの LIF を用意することを推奨しています。

+
image:vmware-vcf-asa-076.png["LIFのネットワーク情報を入力します"]

+
{nbsp}

. ストレージ VM 管理アカウント (マルチテナント環境の場合) を有効にするかどうかを選択し、[保存] をクリックして SVM を作成します。
+
image:vmware-vcf-asa-004.png["SVMアカウントを有効にして完了"]



====
.NVMe名前空間を作成する
[%collapsible%open]
====
NVMe 名前空間は、iSCSI または FC の LUN に類似しています。  vSphere Client から VMFS データストアを展開する前に、NVMe 名前空間を作成する必要があります。  NVMe 名前空間を作成するには、まずクラスタ内の各 ESXi ホストから NVMe 修飾名 (NQN) を取得する必要があります。  NQN は、ネームスペースのアクセス制御を提供するためにONTAPによって使用されます。

NVMe 名前空間を作成するには、次の手順を実行します。

. クラスター内の ESXi ホストとの SSH セッションを開き、その NQN を取得します。  CLI から次のコマンドを使用します。
+
[source, cli]
----
esxcli nvme info get
----
+
次のような出力が表示されます。

+
[source, cli]
----
Host NQN: nqn.2014-08.com.netapp.sddc:nvme:vcf-wkld-esx01
----
. クラスタ内の各ESXiホストのNQNを記録します。
. ONTAP System Manager から、左側のメニューの *NVMe Namespaces* に移動し、*+ Add* をクリックして開始します。
+
image:vmware-vcf-asa-093.png["+追加をクリックしてNVMe名前空間を作成します"]

+
{nbsp}

. *NVMe 名前空間の追加* ページで、名前のプレフィックス、作成する名前空間の数、名前空間のサイズ、名前空間にアクセスするホスト オペレーティング システムを入力します。  *ホスト NQN* セクションで、名前空間にアクセスする ESXi ホストから以前に収集された NQN のコンマ区切りリストを作成します。


スナップショット保護ポリシーなどの追加項目を構成するには、[*その他のオプション*] をクリックします。最後に、「*保存*」をクリックして NVMe 名前空間を作成します。

+image:vmware-vcf-asa-093.png["+追加をクリックしてNVMe名前空間を作成します"]

====


=== ESXiホストでネットワークとNVMeソフトウェアアダプタを設定する

次の手順は、vSphere クライアントを使用して VI ワークロード ドメイン クラスタで実行されます。この場合、vCenter Single Sign-On が使用されているため、vSphere クライアントは管理ドメインとワークロード ドメインの両方で共通になります。

.NVME/TCPトラフィック用の分散ポートグループを作成する
[%collapsible%open]
====
各 NVMe/TCP ネットワークに新しい分散ポート グループを作成するには、次の手順を実行します。

. vSphere クライアントから、ワークロード ドメインの *インベントリ > ネットワーク* に移動します。既存の分散スイッチに移動し、*新しい分散ポート グループ...*を作成するアクションを選択します。
+
image:vmware-vcf-asa-022.png["新しいポートグループの作成を選択"]

+
{nbsp}

. *新しい分散ポート グループ* ウィザードで、新しいポート グループの名前を入力し、*次へ* をクリックして続行します。
. *設定の構成*ページですべての設定を入力します。 VLAN が使用されている場合は、正しい VLAN ID を必ず指定してください。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-023.png["VLAN IDを入力してください"]

+
{nbsp}

. *完了準備完了*ページで変更を確認し、*完了*をクリックして新しい分散ポート グループを作成します。
. このプロセスを繰り返して、使用されている 2 番目の NVMe/TCP ネットワークの分散ポート グループを作成し、正しい *VLAN ID* を入力したことを確認します。
. 両方のポート グループが作成されたら、最初のポート グループに移動し、[設定の編集...] アクションを選択します。
+
image:vmware-vcf-asa-077.png["DPG - 設定の編集"]

+
{nbsp}

. *分散ポート グループ - 設定の編集* ページで、左側のメニューの *チーミングとフェイルオーバー* に移動し、 *uplink2* をクリックして *未使用のアップリンク* まで下に移動します。
+
image:vmware-vcf-asa-078.png["アップリンク2を未使用に移動する"]

. 2 番目の NVMe/TCP ポート グループに対してこの手順を繰り返します。ただし、今回は *uplink1* を *Unused uplinks* まで下に移動します。
+
image:vmware-vcf-asa-079.png["アップリンク1を未使用に移動する"]



====
.各ESXiホストにVMkernelアダプタを作成する
[%collapsible%open]
====
ワークロード ドメイン内の各 ESXi ホストでこのプロセスを繰り返します。

. vSphere クライアントから、ワークロード ドメイン インベントリ内の ESXi ホストの 1 つに移動します。  *構成*タブから*VMkernelアダプタ*を選択し、*ネットワークの追加...*をクリックして開始します。
+
image:vmware-vcf-asa-030.png["ネットワーク追加ウィザードを開始する"]

+
{nbsp}

. *接続タイプの選択* ウィンドウで *VMkernel ネットワーク アダプタ* を選択し、*次へ* をクリックして続行します。
+
image:vmware-vcf-asa-008.png["VMkernelネットワークアダプタを選択"]

+
{nbsp}

. *ターゲット デバイスの選択* ページで、以前に作成した iSCSI の分散ポート グループの 1 つを選択します。
+
image:vmware-vcf-asa-095.png["ターゲットポートグループを選択"]

+
{nbsp}

. *ポート プロパティ* ページで、*NVMe over TCP* のボックスをクリックし、*次へ* をクリックして続行します。
+
image:vmware-vcf-asa-096.png["VMkernelポートのプロパティ"]

+
{nbsp}

. *IPv4 設定* ページで、*IP アドレス*、*サブネット マスク* を入力し、新しいゲートウェイ IP アドレスを指定します (必要な場合のみ)。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-097.png["VMkernel IPv4設定"]

+
{nbsp}

. *準備完了*ページで選択内容を確認し、*完了*をクリックして VMkernel アダプタを作成します。
+
image:vmware-vcf-asa-098.png["VMkernelの選択を確認する"]

+
{nbsp}

. このプロセスを繰り返して、2 番目の iSCSI ネットワーク用の VMkernel アダプタを作成します。


====
.NVMe over TCPアダプタを追加する
[%collapsible%open]
====
ワークロード ドメイン クラスタ内の各 ESXi ホストには、ストレージ トラフィック専用の確立された NVMe/TCP ネットワークごとに NVMe over TCP ソフトウェア アダプタがインストールされている必要があります。

NVMe over TCP アダプターをインストールし、NVMe コントローラーを検出するには、次の手順を実行します。

. vSphere クライアントで、ワークロード ドメイン クラスタ内の ESXi ホストの 1 つに移動します。  *構成*タブからメニューの*ストレージ アダプタ*をクリックし、*ソフトウェア アダプタの追加*ドロップダウン メニューから*NVMe over TCP アダプタの追加*を選択します。
+
image:vmware-vcf-asa-099.png["NVMe over TCPアダプタを追加する"]

+
{nbsp}

. *ソフトウェア NVMe over TCP アダプターの追加* ウィンドウで、*物理ネットワーク アダプター* ドロップダウン メニューにアクセスし、NVMe アダプターを有効にする正しい物理ネットワーク アダプターを選択します。
+
image:vmware-vcf-asa-100.png["物理アダプタを選択"]

+
{nbsp}

. NVMe over TCP トラフィックに割り当てられた 2 番目のネットワークに対してこのプロセスを繰り返し、正しい物理アダプターを割り当てます。
. 新しくインストールされた NVMe over TCP アダプターの 1 つを選択し、[*コントローラー*] タブで [コントローラーの追加*] を選択します。
+
image:vmware-vcf-asa-101.png["コントローラーを追加"]

+
{nbsp}

. *コントローラーの追加* ウィンドウで、*自動* タブを選択し、次の手順を実行します。
+
** この NVMe over TCP アダプタに割り当てられた物理アダプタと同じネットワーク上の SVM 論理インターフェイスの 1 つに IP アドレスを入力します。
** *コントローラーの検出*ボタンをクリックします。
** 検出されたコントローラのリストから、この NVMe over TCP アダプタと一致するネットワーク アドレスを持つ 2 つのコントローラのチェック ボックスをクリックします。
** 選択したコントローラーを追加するには、[*OK*] ボタンをクリックします。
+
image:vmware-vcf-asa-102.png["コントローラーの検出と追加"]

+
{nbsp}



. 数秒後、NVMe 名前空間が [デバイス] タブに表示されます。
+
image:vmware-vcf-asa-103.png["デバイスの下にリストされているNVMe名前空間"]

+
{nbsp}

. この手順を繰り返して、NVMe/TCP トラフィック用に確立された 2 番目のネットワークの NVMe over TCP アダプターを作成します。


====
.NVMe over TCPデータストアを展開する
[%collapsible%open]
====
NVMe 名前空間に VMFS データストアを作成するには、次の手順を実行します。

. vSphere クライアントで、ワークロード ドメイン クラスタ内の ESXi ホストの 1 つに移動します。  *アクション* メニューから *ストレージ > 新しいデータストア...* を選択します。
+
image:vmware-vcf-asa-104.png["NVMe over TCPアダプタを追加する"]

+
{nbsp}

. *新しいデータストア*ウィザードで、タイプとして*VMFS*を選択します。続行するには、[次へ] をクリックします。
. *名前とデバイスの選択*ページで、データストアの名前を入力し、使用可能なデバイスのリストから NVMe 名前空間を選択します。
+
image:vmware-vcf-asa-105.png["名前とデバイスの選択"]

+
{nbsp}

. *VMFS バージョン* ページで、データストアの VMFS のバージョンを選択します。
. *パーティション構成*ページで、デフォルトのパーティション スキームに必要な変更を加えます。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-106.png["NVMeパーティション構成"]

+
{nbsp}

. *完了準備完了*ページで概要を確認し、*完了*をクリックしてデータストアを作成します。
. インベントリ内の新しいデータストアに移動し、[ホスト] タブをクリックします。正しく構成されている場合、クラスター内のすべての ESXi ホストがリストされ、新しいデータストアにアクセスできるようになります。
+
image:vmware-vcf-asa-107.png["データストアに接続されたホスト"]

+
{nbsp}



====


== 追加情報

ONTAPストレージシステムの構成については、link:https://docs.netapp.com/us-en/ontap["ONTAP 9ドキュメント"]中心。

VCFの設定方法については、以下を参照してください。link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware Cloud Foundation ドキュメント"] 。
