---
sidebar: sidebar 
permalink: vmware/vmw-vcf-mgmt-supplemental-iscsi.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= ONTAP tools for VMware vSphereを使用して、管理ドメインの補助ストレージとして iSCSI データストアを追加します。
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このユースケースでは、VMware Cloud Foundation (VCF) 管理ドメインの補助ストレージとして iSCSI データストアを追加する手順について説明します。この手順では、iSCSI 用の論理インターフェイス (LIF) を使用したストレージ仮想マシン (SVM) のセットアップ、ESXi ホストでの iSCSI ネットワークの構成、VMware vSphere 用のONTAPツールの導入、および VMFS データストアの作成についてまとめています。



== iSCSIの利点

*高性能:* 高速で効率的なデータ転送速度と低遅延を実現する高性能を提供します。要求の厳しいエンタープライズ アプリケーションや仮想化環境に最適です。

*管理の容易さ:* 使い慣れた IP ベースのツールとプロトコルを使用して、ストレージ管理を簡素化します。

*コスト効率が高い:* 既存のイーサネット インフラストラクチャを活用することで、特殊なハードウェアの必要性が減り、組織は信頼性が高くスケーラブルなストレージ ソリューションを実現できます。

NetAppストレージシステムでiSCSIを使用する方法の詳細については、以下を参照してください。 https://docs.netapp.com/us-en/ontap/san-admin/san-host-provisioning-concept.html["iSCSI による SAN プロビジョニング"] 。



== シナリオの概要

このシナリオでは、次の大まかな手順について説明します。

* iSCSI トラフィック用の論理インターフェイス (LIF) を備えたストレージ仮想マシン (SVM) を作成します。
* VCF 管理ドメイン上の iSCSI ネットワークの分散ポート グループを作成します。
* VCF 管理ドメインの ESXi ホスト上に iSCSI 用の vmkernel アダプタを作成します。
* VCF 管理ドメインにONTAPツールを導入します。
* VCF 管理ドメインに新しい VMFS データストアを作成します。




== 前提条件

このシナリオには、次のコンポーネントと構成が必要です。

* ストレージ トラフィック専用のイーサネット スイッチ上に物理データ ポートを備えたONTAP AFFまたはASAストレージ システム。
* VCF 管理ドメインの展開が完了し、vSphere クライアントにアクセスできるようになりました。


NetApp は、iSCSI に対して完全に冗長化されたネットワーク設計を推奨しています。次の図は、ストレージ システム、スイッチ、ネットワーク アダプタ、およびホスト システムにフォールト トレランスを提供する冗長構成の例を示しています。  NetAppを参照してくださいlink:https://docs.netapp.com/us-en/ontap/san-config/index.html["SAN構成に関するリファレンス"]追加情報については、こちらをご覧ください。

image:vmware-vcf-asa-074.png["iSCSIネットワーク設計"]{nbsp}

複数のパスにわたるマルチパスとフェイルオーバーのために、 NetApp、iSCSI 構成のすべての SVM に対して、個別のイーサネット ネットワーク内のストレージ ノードごとに少なくとも 2 つの LIF を用意することを推奨しています。

このドキュメントでは、新しい SVM を作成し、IP アドレス情報を指定して iSCSI トラフィック用の複数の LIF を作成するプロセスについて説明します。既存のSVMに新しいLIFを追加するには、link:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIF（ネットワーク インターフェイス）の作成"] 。

VMwareでVMFS iSCSIデータストアを使用する方法の詳細については、以下を参照してください。link:vmw-vmfs-iscsi.html["vSphere VMFS データストア - ONTAPを使用した iSCSI ストレージ バックエンド"] 。


TIP: 複数の VMkernel アダプタが同じ IP ネットワーク上に構成されている場合は、アダプタ間で負荷分散が行われるように、ESXi ホストでソフトウェア iSCSI ポート バインディングを使用することをお勧めします。  KB記事を参照してくださいlink:https://knowledge.broadcom.com/external/article?legacyId=2038869["ESX/ESXi でソフトウェア iSCSI ポート バインディングを使用する際の考慮事項 (2038869)"]。



== 展開手順

ONTAPツールを導入し、それを使用して VCF 管理ドメインに VMFS データストアを作成するには、次の手順を実行します。



=== ONTAPストレージシステム上にSVMとLIFを作成する

次の手順はONTAP System Manager で実行されます。

.ストレージVMとLIFを作成する
[%collapsible%open]
====
iSCSI トラフィック用の複数の LIF とともに SVM を作成するには、次の手順を実行します。

. ONTAP System Manager から、左側のメニューの *Storage VMs* に移動し、*+ Add* をクリックして開始します。
+
image:vmware-vcf-asa-001.png["+追加をクリックしてSVMの作成を開始します"]

+
{nbsp}

. *ストレージ VM の追加* ウィザードで、SVM の *名前* を入力し、*IP スペース* を選択して、*アクセス プロトコル* の下にある *iSCSI* タブをクリックし、*iSCSI を有効にする* チェックボックスをオンにします。
+
image:vmware-vcf-asa-002.png["ストレージVMの追加ウィザード - iSCSIを有効にする"]

. *ネットワーク インターフェイス* セクションで、最初の LIF の *IP アドレス*、*サブネット マスク*、および *ブロードキャスト ドメインとポート* を入力します。後続の LIF については、チェックボックスを有効にして、残りのすべての LIF で共通の設定を使用するか、個別の設定を使用するかを選択できます。
+

NOTE: 複数のパスにわたるマルチパスとフェイルオーバーのために、 NetApp、iSCSI 構成のすべての SVM に対して、個別のイーサネット ネットワーク内のストレージ ノードごとに少なくとも 2 つの LIF を用意することを推奨しています。

+
image:vmware-vcf-asa-003.png["LIFのネットワーク情報を入力します"]

. ストレージ VM 管理アカウント (マルチテナント環境の場合) を有効にするかどうかを選択し、[保存] をクリックして SVM を作成します。
+
image:vmware-vcf-asa-004.png["SVMアカウントを有効にして完了"]



====


=== ESXiホストでiSCSIのネットワークを設定する

次の手順は、vSphere クライアントを使用して VCF 管理ドメイン クラスタで実行されます。

.iSCSIトラフィック用の分散ポートグループを作成する
[%collapsible%open]
====
各 iSCSI ネットワークに新しい分散ポート グループを作成するには、次の手順を実行します。

. 管理ドメイン クラスタの vSphere クライアントから、*インベントリ > ネットワーク* に移動します。既存の分散スイッチに移動し、*新しい分散ポート グループ...*を作成するアクションを選択します。
+
image:vmware-vcf-asa-005.png["新しいポートグループの作成を選択"]

+
{nbsp}

. *新しい分散ポート グループ* ウィザードで、新しいポート グループの名前を入力し、*次へ* をクリックして続行します。
. *設定の構成*ページですべての設定を入力します。 VLAN が使用されている場合は、正しい VLAN ID を必ず指定してください。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-006.png["VLAN IDを入力してください"]

+
{nbsp}

. *完了準備完了*ページで変更を確認し、*完了*をクリックして新しい分散ポート グループを作成します。
. このプロセスを繰り返して、使用されている 2 番目の iSCSI ネットワークの分散ポート グループを作成し、正しい *VLAN ID* を入力したことを確認します。
. 両方のポート グループが作成されたら、最初のポート グループに移動し、[設定の編集...] アクションを選択します。
+
image:vmware-vcf-asa-027.png["DPG - 設定の編集"]

+
{nbsp}

. *分散ポート グループ - 設定の編集* ページで、左側のメニューの *チーミングとフェイルオーバー* に移動し、 *uplink2* をクリックして *未使用のアップリンク* まで下に移動します。
+
image:vmware-vcf-asa-028.png["アップリンク2を未使用に移動する"]

. 2 番目の iSCSI ポート グループに対してこの手順を繰り返します。ただし、今回は *uplink1* を *Unused uplinks* まで下に移動します。
+
image:vmware-vcf-asa-029.png["アップリンク1を未使用に移動する"]



====
.各ESXiホストにVMkernelアダプタを作成する
[%collapsible%open]
====
管理ドメイン内の各 ESXi ホストでこのプロセスを繰り返します。

. vSphere クライアントから、管理ドメイン インベントリ内の ESXi ホストの 1 つに移動します。  *構成*タブから*VMkernelアダプタ*を選択し、*ネットワークの追加...*をクリックして開始します。
+
image:vmware-vcf-asa-007.png["ネットワーク追加ウィザードを開始する"]

+
{nbsp}

. *接続タイプの選択* ウィンドウで *VMkernel ネットワーク アダプタ* を選択し、*次へ* をクリックして続行します。
+
image:vmware-vcf-asa-008.png["VMkernelネットワークアダプタを選択"]

+
{nbsp}

. *ターゲット デバイスの選択* ページで、以前に作成した iSCSI の分散ポート グループの 1 つを選択します。
+
image:vmware-vcf-asa-009.png["ターゲットポートグループを選択"]

+
{nbsp}

. *ポート プロパティ* ページでデフォルトをそのままにして、*次へ* をクリックして続行します。
+
image:vmware-vcf-asa-010.png["VMkernelポートのプロパティ"]

+
{nbsp}

. *IPv4 設定* ページで、*IP アドレス*、*サブネット マスク* を入力し、新しいゲートウェイ IP アドレスを指定します (必要な場合のみ)。続行するには、[次へ] をクリックします。
+
image:vmware-vcf-asa-011.png["VMkernel IPv4設定"]

+
{nbsp}

. *準備完了*ページで選択内容を確認し、*完了*をクリックして VMkernel アダプタを作成します。
+
image:vmware-vcf-asa-012.png["VMkernelの選択を確認する"]

+
{nbsp}

. このプロセスを繰り返して、2 番目の iSCSI ネットワーク用の VMkernel アダプタを作成します。


====


=== ONTAPツールを導入して使用し、ストレージを構成する

次の手順は、vSphere クライアントを使用して VCF 管理ドメイン クラスタ上で実行され、OTV の展開、VMFS iSCSI データストアの作成、管理 VM の新しいデータストアへの移行が含まれます。

.ONTAP tools for VMware vSphereを導入する
[%collapsible%open]
====
ONTAP tools for VMware vSphereは、 VM アプライアンスとして導入され、 ONTAPストレージを管理するための統合された vCenter UI を提供します。

ONTAP tools for VMware vSphereをデプロイするには、次の手順を実行します。

. ONTAPツールOVAイメージを以下から入手します。link:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab["NetApp サポート サイト"]ローカルフォルダーにダウンロードします。
. VCF 管理ドメインの vCenter アプライアンスにログインします。
. vCenter アプライアンス インターフェースから管理クラスタを右クリックし、[OVF テンプレートのデプロイ...] を選択します。
+
image:vmware-vcf-aff-021.png["OVF テンプレートをデプロイします..."]

+
{nbsp}

. *OVF テンプレートのデプロイ*ウィザードで、*ローカル ファイル*ラジオ ボタンをクリックし、前の手順でダウンロードしたONTAPツール OVA ファイルを選択します。
+
image:vmware-vcf-aff-022.png["OVAファイルを選択"]

+
{nbsp}

. ウィザードの手順 2 ～ 5 では、VM の名前とフォルダーを選択し、コンピューティング リソースを選択し、詳細を確認して、ライセンス契約に同意します。
. 構成ファイルとディスク ファイルの保存場所として、VCF 管理ドメイン クラスタの vSAN データストアを選択します。
+
image:vmware-vcf-aff-023.png["OVAファイルを選択"]

+
{nbsp}

. [ネットワークの選択] ページで、管理トラフィックに使用するネットワークを選択します。
+
image:vmware-vcf-aff-024.png["ネットワークを選択"]

+
{nbsp}

. テンプレートのカスタマイズページで、必要な情報をすべて入力します。
+
** OTV への管理アクセスに使用するパスワード。
** NTPサーバのIPアドレスを指定します。
** OTV メンテナンス アカウントのパスワード。
** OTVダービーDBパスワード。
** *VMware Cloud Foundation (VCF) を有効にする* チェックボックスをオンにしないでください。補助ストレージを展開する場合、VCF モードは必要ありません。
** vCenter アプライアンスの FQDN または IP アドレスと、vCenter の資格情報を提供します。
** 必要なネットワーク プロパティ フィールドを指定します。
+
続行するには、[次へ] をクリックします。

+
image:vmware-vcf-aff-025.png["OTV テンプレート 1 をカスタマイズする"]

+
image:vmware-vcf-asa-013.png["OTVテンプレート2をカスタマイズする"]

+
{nbsp}



. [Ready to complete] ページですべての情報を確認し、[Finish] をクリックして OTV アプライアンスの展開を開始します。


====
.OTVを使用して管理ドメインにVMFS iSCSIデータストアを構成する
[%collapsible%open]
====
OTV を使用して VMFS iSCSI データストアを管理ドメインの補助ストレージとして構成するには、次の手順を実行します。

. vSphere クライアントでメイン メニューに移動し、* NetApp ONTAPツール* を選択します。
+
image:vmware-vcf-asa-014.png["ONTAPツールへ移動"]

. * ONTAPツール* に入ったら、[Getting Started] ページ (または *Storage Systems*) から [Add] をクリックして、新しいストレージ システムを追加します。
+
image:vmware-vcf-asa-015.png["ストレージ システムの追加"]

+
{nbsp}

. ONTAPストレージ システムの IP アドレスと資格情報を入力し、[*追加*] をクリックします。
+
image:vmware-vcf-asa-016.png["ONTAPシステムのIPと認証情報を提供する"]

+
{nbsp}

. 「*はい*」をクリックしてクラスター証明書を承認し、ストレージ システムを追加します。
+
image:vmware-vcf-asa-017.png["クラスタ証明書を承認する"]



====
.管理VMをiSCSIデータストアに移行する
[%collapsible%open]
====
VCF 管理 VM を保護するためにONTAPストレージを使用することが望ましい場合は、vMotion を使用して VM を新しく作成された iSCSI データストアに移行できます。

VCF 管理 VM を iSCSI データストアに移行するには、次の手順を実行します。

. vSphere Client から管理ドメイン クラスタに移動し、[VM] タブをクリックします。
. iSCSI データストアに移行する VM を選択し、右クリックして [移行] を選択します。
+
image:vmware-vcf-asa-018.png["移行するVMを選択"]

+
{nbsp}

. *仮想マシン - 移行*ウィザードで、移行タイプとして*ストレージのみの変更*を選択し、*次へ*をクリックして続行します。
+
image:vmware-vcf-asa-019.png["移行タイプを選択"]

+
{nbsp}

. *ストレージの選択*ページで、iSCSi データストアを選択し、*次へ*を選択して続行します。
+
image:vmware-vcf-asa-020.png["宛先データストアを選択"]

+
{nbsp}

. 選択内容を確認し、「完了」をクリックして移行を開始します。
. 移転ステータスは、[最近のタスク] ペインから確認できます。
+
image:vmware-vcf-asa-021.png["vSphere クライアントの最近のタスク ペイン"]



====


== 追加情報

ONTAPストレージシステムの構成については、link:https://docs.netapp.com/us-en/ontap["ONTAP 9ドキュメント"]中心。

VCFの設定方法については、以下を参照してください。link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware Cloud Foundation ドキュメント"] 。



== このソリューションのビデオデモ

.VCF管理ドメインの補助ストレージとしてのiSCSIデータストア
video::1d0e1af1-40ae-483a-be6f-b156015507cc[panopto,width=360]