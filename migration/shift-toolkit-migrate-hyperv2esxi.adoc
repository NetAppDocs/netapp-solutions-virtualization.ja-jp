---
sidebar: sidebar 
permalink: migration/shift-toolkit-migrate-hyperv2esxi.html 
keywords: netapp, vmware, esxi, vm, migration, virtualization, hyper-v, microsoft 
summary: Shift Toolkit を使用して、ソース サイトと宛先サイトを構成し、リソース グループとブループリントを作成し、移行ワークフローを実行することで、Microsoft Hyper-V から VMware ESXi に VM を移行します。 
---
= Shift Toolkit を使用して Microsoft Hyper-V から VMware ESXi に VM を移行する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Shift Toolkit を使用して、ソース サイトと宛先サイトを構成し、リソース グループとブループリントを作成し、移行ワークフローを実行することで、Microsoft Hyper-V から VMware ESXi に VM を移行します。

Shift Toolkit を使用すると、追加のディスク コピーを作成せずにハイパーバイザー間で直接 VM を変換できるため、Windows と Linux の両方の仮想マシンで、ダウンタイムを最小限に抑えながらコピーレスの移行を実現できます。



== 開始する前に

移行を開始する前に、次の前提条件が満たされていることを確認してください。

.VMware の要件
* vCenterとESXiホストが構成されている
* 最低限必要な権限を持つ vCenter Server アカウント (RBAC ユーザー)
* vCenterおよびESXiホストはShift Toolkitからアクセス可能であり、DNSエントリは最新である
* 分散ポート グループは適切な VLAN ID で構成されます (標準ポート グループはサポートされていません)
* NFS共有（移行されたVMを保存するためのもの）とソース共有（移行されるVM用）は同じボリューム上に存在します


.Hyper-V の要件
* VM VHDxファイルはSMB共有上に配置されます
+
** VMがクラスタ共有ボリューム（CSV）上にある場合は、SMB共有へのライブマイグレーションを実行します。


* Hyper-V 統合サービスが有効化され、ゲスト VM 上で実行されている
* 移行対象のVMは準備のため実行状態にあります
* 移行を開始する前にVMの電源をオフにする必要があります


.ゲストVMの要件
* Windows VMの場合: VM上の既存のユーザープロファイルを持つローカル管理者の資格情報またはドメイン資格情報を使用します
* Linux VMの場合: パスワードプロンプトなしでsudoコマンドを実行する権限を持つユーザーを使用します
* Shift Toolkit は、Windows VM では PowerShell Direct を使用し、Linux VM では SSH を使用します。




== ステップ1: ソースサイトを追加する (Hyper-V)

ソース Hyper-V 環境を Shift Toolkit に追加します。

.手順
. サポートされているブラウザで Shift Toolkit を開き、デフォルトの資格情報でログインします。
. *[検出] > [サイトの追加]*に移動します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-350.png[サイトの追加メニュー]

====
. *新しいサイトを追加*をクリックし、*ソース*を選択します。
. ソースサイトの詳細を入力します。
+
** *サイト名*: サイトの名前を入力してください
** *ハイパーバイザー*: Hyper-Vを選択
** *サイトの場所*: デフォルトのオプションを選択します
** *コネクタ*: デフォルトの選択を選択します


. *続行*をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-351.png[ソースサイトの詳細]

====
. Hyper-V の詳細を入力します。
+
** *Hyper-V スタンドアロンまたはフェールオーバー クラスター マネージャー*: IP アドレスまたは FQDN
** *ユーザー名*: UPN形式のユーザー名（username@domain.comまたはdomain\administrator）
** *パスワード*: Hyper-VホストまたはFCIインスタンスにアクセスするためのパスワード


. *続行*をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-352.png[Hyper-V 資格情報]

====
+

NOTE: Hyper-V FCI とホスト検出は DNS 解決に依存します。解決に失敗した場合は、ホスト ファイル (C:\Windows\System32\drivers\etc\hosts) を更新し、検出操作を再試行してください。

. ONTAPストレージ システムの認証情報を入力します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-353.png[ONTAP認証情報]

====
. *サイトの作成*をクリックします。


.結果
Shift Toolkit は自動検出を実行し、ネットワーク、仮想スイッチ、VLAN ID などのメタデータ情報とともに VM を表示します。

.例を表示
[%collapsible]
====
image::shift-toolkit-354.png[発見の結果]

====

NOTE: VM インベントリは 24 時間ごとに自動更新されます。変更後に手動で更新するには、サイト名の横にある 3 つのドットをクリックし、[サイトの検出] を選択します。



== ステップ2: 宛先サイトを追加する (VMware ESXi)

宛先の VMware 環境を Shift Toolkit に追加します。

.手順
. *新しいサイトを追加*をクリックし、*宛先*を選択します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-357.png[宛先サイトを追加]

====
. 宛先サイトの詳細を入力します。
+
** *サイト名*: サイトの名前を入力してください
** *ハイパーバイザー*: VMwareを選択
** *サイトの場所*: デフォルトのオプションを選択します
** *コネクタ*: デフォルトの選択を選択します


. *続行*をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-358.png[目的地サイトの詳細]

====
. VMware vCenter の詳細を入力します。
+
** *エンドポイント*: vCenter Server の IP アドレスまたは FQDN
** *ユーザー名*: UPN形式のユーザー名 (username@domain.com)
** *vCenter パスワード*: vCenter にアクセスするためのパスワード
** *vCenter SSL サムプリント* (オプション)


. *自己署名証明書を受け入れる*を選択し、*続行*をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-359.png[vCenter の資格情報]

====
. *サイトの作成*をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-360.png[サイト作成の確認]

====
+

NOTE: ディスク形式の変換は同じボリューム内のボリューム レベルで行われるため、ソースと宛先のストレージ システムは同じである必要があります。





== ステップ3: リソースグループを作成する

VM をリソース グループに編成して、ブート順序とブート遅延構成を保持します。

.開始する前に
前提条件で指定されているとおりに qtree がプロビジョニングされていることを確認します。

.手順
. *リソース グループ* に移動し、*新しいリソース グループの作成* をクリックします。
. ドロップダウンからソースサイトを選択し、「作成」をクリックします。
. リソース グループの詳細を入力し、ワークフローを選択します。
+
** *クローンベースの移行*: ソースハイパーバイザーから宛先ハイパーバイザーへのエンドツーエンドの移行を実行します
** *クローンベースの変換*: ディスクフォーマットを選択したハイパーバイザータイプに変換します
+
.例を表示
[%collapsible]
====
image::shift-toolkit-361.png[リソース グループのワークフロー]

====


. *続行*をクリックします。
. 検索オプションを使用して VM を選択します (デフォルトのフィルターは「データストア」です)。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-362.png[VMの選択]

====
+

NOTE: 変換前に、新しく作成されたONTAP SVM 上の指定された SMB 共有に VM を移動し、実稼働共有をステージング領域から分離します。データストアのドロップダウンには SMB 共有のみが表示され、CSV は表示されません。

+
.例を表示
[%collapsible]
====
image::shift-toolkit-363.png[データストアの選択]

====
. 移行の詳細を更新します:
+
** *宛先サイト*を選択
** *宛先VMwareエントリ*を選択
** ボリュームからqtreeへのマッピングを構成する
+
.例を表示
[%collapsible]
====
image::shift-toolkit-364.png[移行の詳細]

====
+

NOTE: VM を Hyper-V から ESXi に変換するときに、宛先パスを適切な qtree に設定します。



. 選択したすべての VM の起動順序と起動遅延を構成します。
+
** *1*: 最初に電源を入れるVM
** *3*: デフォルト
** *5*: 最後に電源を入れたVM


. *リソース グループの作成*をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-365.png[ブート順序の設定]

====


.結果
リソース グループが作成され、ブループリントの構成の準備が整いました。



== ステップ4: 移行ブループリントを作成する

プラットフォーム マッピング、ネットワーク構成、VM 設定などの移行計画を定義するブループリントを作成します。

.手順
. *ブループリント* に移動し、*新しいブループリントの作成* をクリックします。
. ブループリントの名前を指定し、ホスト マッピングを構成します。
+
** *ソースサイト*と関連するHyper-Vハイパーバイザーを選択します
** *宛先サイト*と関連するvCenterを選択します
** ホストとクラスターのマッピングを構成する
+
.例を表示
[%collapsible]
====
image::shift-toolkit-366.png[ブループリントホストマッピング]

====


. リソース グループの詳細を選択し、[続行] をクリックします。
. 複数のグループが存在する場合は、リソース グループの実行順序を設定します。
. 適切なポート グループへのネットワーク マッピングを構成します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-367.png[ネットワークマッピング]

====
+

NOTE: VMware では、分散ポート グループのみがサポートされるオプションです。テスト移行の場合は、本番ネットワークの競合を避けるために「ネットワークを構成しない」を選択し、変換後にネットワーク設定を手動で割り当てます。

+
.例を表示
[%collapsible]
====
image::shift-toolkit-368.png[ネットワーク構成オプション]

====
. ストレージ マッピングを確認します (VM の選択に基づいて自動的に選択されます)。
+

NOTE: 必要な権限で qtree が事前にプロビジョニングされていることを確認します。

. カスタム スクリプトまたは IP アドレスのカスタマイズに必要な場合は、VM 準備のオーバーライドを構成します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-369.png[準備オーバーライド]

====
. VM の詳細で、各 OS タイプに対するサービス アカウントと資格情報を指定します。
+
** *Windows*: ローカル管理者またはドメイン資格情報 (VM にユーザー プロファイルが存在することを確認)
** *Linux*: パスワードプロンプトなしでsudo権限を持つユーザー
+
.例を表示
[%collapsible]
====
image::shift-toolkit-370.png[サービスアカウントの資格情報]

====


. IP 設定を構成します。
+
** *設定しない*: デフォルトオプション
** *IP を保持*: ソースシステムと同じ IP を保持します
** *DHCP*: ターゲットVMにDHCPを割り当てる
+
prepareVM フェーズ中に VM の電源がオンになっており、統合サービスが有効になっていることを確認します。



. VM 設定を構成します。
+
** CPU/RAMパラメータのサイズ変更（オプション）
** 起動順序と起動遅延を変更する
** *電源オン*: 移行後にVMの電源をオンにする場合に選択します（デフォルト: オン）
** *VMware ツールの追加*: 変換後に VMware ツールをインストールします (デフォルト: 選択)
** *MAC アドレスを保持*: ライセンス要件のために MAC アドレスを保持します
** *サービス アカウントのオーバーライド*: 必要に応じて別のサービス アカウントを指定します
+
.例を表示
[%collapsible]
====
image::shift-toolkit-371.png[VM構成]

====


. *続行*をクリックします。
. (オプション) 日時を選択して移行をスケジュールします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-372.png[移行スケジュール]

====
+

NOTE: VM の準備に時間をかけるため、移行は少なくとも 30 分前にスケジュールしてください。

. *ブループリントを作成*をクリックします。


.結果
Shift Toolkit は、移行の準備としてソース VM 上でスクリプトを実行する prepareVM ジョブを開始します。

.例を表示
[%collapsible]
====
image::shift-toolkit-373.png[PrepareVMジョブが開始されました]

====
準備プロセス:

* Windows VMの場合: スクリプトを以下に保存します `C:\NetApp`
+
.例を表示
[%collapsible]
====
image::shift-toolkit-374.png[Windows準備スクリプト]

====
* Linux VMの場合: スクリプトを次の場所に保存します `/NetApp`そして `/opt`
+
.例を表示
[%collapsible]
====
image::shift-toolkit-375.png[Linux準備スクリプト]

====
+

NOTE: CentOS または Red Hat VM の場合、Shift Toolkit はディスク変換前に必要なドライバーを自動的にインストールし、変換後の起動が正常に行われるようにします。



prepareVM が正常に完了すると、ブループリントのステータスが「アクティブ」に更新されます。

.例を表示
[%collapsible]
====
image::shift-toolkit-376.png[ブループリントのアクティブステータス]

====


== ステップ5: 移行を実行する

移行ワークフローをトリガーして、VM を Hyper-V から VMware ESXi に変換します。

.開始する前に
* すべてのVMは計画されたメンテナンススケジュールに従って正常に電源オフになります
* Shift Toolkit VMはドメインの一部です
* CIFS共有が適切な権限で構成されている
* Qtreeには正しいセキュリティスタイルがあります
* すべてのゲストVMで統合サービスが有効になっています
* LinuxベースのゲストVMでSSHが有効になっています


.手順
. ブループリントで、[移行] をクリックします。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-377.png[移行ボタン]

====
. VM の電源がオンのままの場合は、正常なシャットダウンのプロンプトに応答します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-378.png[シャットダウンの確認]

====
+
.例を表示
[%collapsible]
====
image::shift-toolkit-379.png[移行中]

====


.結果
Shift Toolkit は次の手順を実行します。

. ソースVMの電源をオフにする
. 既存のチェックポイントを削除します
. ソースでVMチェックポイントをトリガーします
. ディスク変換前にボリュームのスナップショットをトリガーします
. VHDx ファイルを複製し、VMDK 形式に変換します
. ターゲットサイトでVMの電源をオンにします
. ネットワーク設定を登録する
. VMware Toolsを追加し、IPアドレスを割り当てます


変換は数秒で完了し、VM のダウンタイムが最小限に抑えられます。

.例を表示
[%collapsible]
====
image::shift-toolkit-380.png[変換の進捗状況]

====
移行が完了すると、ブループリントのステータスが「移行完了」に変わります。

.例を表示
[%collapsible]
====
image::shift-toolkit-381.png[移行完了]

====


== ステップ6: 移行を検証する

VMware ESXi ホスト上で VM が正常に実行されていることを確認します。

.手順
. vCenter または ESXi ホストにログインします。
. 指定された ESXi ホスト上で VM が実行されていることを確認します。
+
.例を表示
[%collapsible]
====
image::shift-toolkit-382.png[ESXi上で実行されているVM]

====
. VM の接続性とアプリケーションの機能を確認します。
. (Windows VM のみ) 必要に応じてオフライン ディスクをオンラインにします。
+
[listing]
----
Set-StorageSetting -NewDiskPolicy OnlineAll
----
+

NOTE: 変換後、デフォルトの Microsoft Windows SAN ポリシー (offlineALL) により、OS ディスクを除く Windows OS 上のすべての VM ディスクがオフラインになります。これにより、複数のサーバーが LUN にアクセスしたときにデータの破損を防ぐことができます。



.結果
Hyper-V から VMware ESXi への移行が完了しました。


NOTE: Shift Toolkit は、移行後の操作に cron ジョブ (Linux) とスケジュールされたタスク (Windows) を使用します。  VM が ESXi ホスト上で実行された後、SSH 接続または同等の接続は作成されません。
