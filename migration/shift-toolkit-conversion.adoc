---
sidebar: sidebar 
permalink: migration/shift-toolkit-conversion.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= Shift Toolkit を使用して VM を変換する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Shift Toolkit を使用して、VMware ESX 仮想マシン ディスク (VMDK) を Microsoft Hyper-V (VHDX) ディスク形式または Red Hat KVM (QCOW2) ディスク形式に変換します。このプロセスには、リソース グループの設定、変換ブループリントの作成、変換のスケジュール設定が含まれます。



== 概要

Shift ツールキットは、次のディスク形式のハイパーバイザー間での仮想ディスクのディスク レベルの変換をサポートします。

* VMware ESX から Microsoft Hyper-V (VMDK から VHDX)
* Microsoft Hyper-V から VMware ESX (VHDX から VMDK)
* VMware ESX から Red Hat KVM (VMDK から QCOW2)
* VMware ESX から Red Hat KVM (VMDK から RAW)


変換された qcow2 ファイルは、どの KVM ハイパーバイザーとも互換性があります。たとえば、qcow2 ファイルは、virt-manager を使用して VM を作成する RHEL ベースの KVM のほか、ubuntu KVM、Rocky Linux ベースの KVM などでも利用できます。同じものを、微調整を加えた Oracle Linux 仮想化マネージャーでも、またNetApp Tridentを使用してインポートした後の OpenShift 仮想化でも使用できます。目標は、ディスク（秒単位から分単位に変換）を提供し、それを組織が VM をプロビジョニングしてネットワークを割り当てるために使用する既存の自動化スクリプトに統合できるようにすることです。このアプローチは、ディスク変換が Shift ツールキット API によって処理され、残りのスクリプトで VM が起動されるため、全体的な移行時間を短縮するのに役立ちます。

Shift ツールキットは、VMware から他の互換性のある KVM ハイパーバイザーへのエンドツーエンドの移行をサポートします。ただし、変換オプションにより、移行管理者はこれらの変換および移行 API を実行できるようになります。



== QCOW2形式に変換する

NetApp Shift ツールキットを使用して仮想ディスクを QCOW2 形式に変換するには、次の大まかな手順に従います。

* ハイパーバイザーとして KVM (変換のみ) を指定して、宛先サイト タイプを作成します。
+
注: KVM の場合、ハイパーバイザーの詳細は必要ありません。

+
image::shift-toolkit-150.png[宛先サイトの作成手順のダイアログ]

* ディスク変換が必要なVMを含むリソースグループを作成します
+
image::shift-toolkit-151.png[リソース グループの作成手順のダイアログ]

+
image::shift-toolkit-152.png[リソース グループの作成手順のダイアログ]

+
image::shift-toolkit-153.png[リソース グループの作成手順のダイアログ]

* 仮想ディスクを QCOW2 形式に変換するためのブループリントを作成します。
+
image::shift-toolkit-154.png[ブループリント作成ステップのダイアログ]

+
image::shift-toolkit-155.png[ブループリント作成ステップのダイアログ]

+
image::shift-toolkit-156.png[ブループリント作成ステップのダイアログ]

* スケジュール オプションを使用してスロットを指定します。変換をアドホック ベースで実行する場合には、スケジュール オプションのチェックをオフのままにします。
+
image::shift-toolkit-157.png[スケジュールオプションステップのダイアログ]

* ブループリントが作成されると、prepareVM ジョブがトリガーされます。このジョブは、ソース VM 上でスクリプトを自動的に実行し、変換の準備をします。これらのスクリプトは、VMware Tools を削除し、ターゲットのハイパーバイザーの要件に合わせてドライバーを更新します。
+
image::shift-toolkit-158.png[VMの準備ステップのダイアログ]

* PrepareVM ジョブが正常に完了すると (下のスクリーンショットを参照)、VM に関連付けられた VM ディスクの変換準備が完了し、ブループリントのステータスが「アクティブ」に更新されます。
* VM に必要なダウンタイムをスケジュールした後、「変換」をクリックします。
+
image::shift-toolkit-159.png[VM変換ステップのダイアログ]

* 変換操作では、ポイントインタイムスナップショットが使用されます。必要に応じて VM の電源をオフにしてから、操作を再トリガーします。
+
image::shift-toolkit-160.png[VMの電源をオフにする手順の検証ダイアログ]

* 変換操作では、VM とそれぞれのディスクに対して各操作が実行され、適切な形式が生成されます。
+
image::shift-toolkit-161.png[VM変換ステップの結果のダイアログ]

* 手動で VM を作成し、ディスクを VM に接続して、変換されたディスクを使用します。
+
image::shift-toolkit-162.png[ディスクを手動で変換する手順のダイアログ]



注: Shift ツールキットは、qcow2 形式のディスク変換のみをサポートします。VM の作成または登録はサポートされていません。変換されたディスクを使用するには、手動で VM を作成し、ディスクを接続します。



== VHDX形式に変換する

NetApp Shift ツールキットを使用して仮想ディスクを VHDX 形式に変換するには、次の大まかな手順に従います。

* ハイパーバイザーとして Hyper-V を指定して、宛先サイト タイプを作成します。
* ディスク変換が必要なVMを含むリソースグループを作成します
+
image::shift-toolkit-163.png[リソース グループの作成手順のダイアログ]

+
image::shift-toolkit-164.png[リソース グループの作成手順のダイアログ]

* 仮想ディスクを VHDX 形式に変換するためのブループリントを作成します。ブループリントが作成されると、準備ジョブが自動的に開始されます。
+
image::shift-toolkit-165.png[ブループリント作成ステップのダイアログ]

* VM に必要なダウンタイムがスケジュールされたら、「変換」を選択します。
+
image::shift-toolkit-166.png[変換ステップのダイアログ]

* 変換操作では、VM とそれぞれのディスクに対して各操作が実行され、適切な VHDX 形式が生成されます。
+
image::shift-toolkit-167.png[変換ステップのダイアログ]

* 手動で VM を作成し、ディスクを VM に接続して、変換されたディスクを使用します。
+
image::shift-toolkit-168.png[変換ステップのダイアログ]



注: 変換された VHDX ディスクを VM で使用するには、Hyper-V マネージャーまたは PowerShell コマンドを使用して VM を手動で作成し、ディスクを VM に接続する必要があります。これに加えて、ネットワークも手動でマッピングする必要があります。



== RAW形式に変換する

NetApp Shift ツールキットを使用して仮想ディスクを RAW 形式に変換するには、次の大まかな手順に従います。

* ハイパーバイザーとして OpenShift または OLVM を指定して、宛先サイト タイプを作成します。
* ディスク変換が必要なVMを含むリソースグループを作成します
+
image::shift-toolkit-169.png[リソース グループの作成手順のダイアログ]

+
image::shift-toolkit-170.png[リソース グループの作成手順のダイアログ]

+
image::shift-toolkit-171.png[リソース グループの作成手順のダイアログ]

* 仮想ディスクを RAW 形式に変換するためのブループリントを作成します。ブループリントが作成されると、準備ジョブが自動的に開始されます。
+
image::shift-toolkit-172.png[ブループリント作成ステップのダイアログ]

* VM に必要なダウンタイムがスケジュールされたら、「変換」を選択します。
+
image::shift-toolkit-173.png[変換ステップのダイアログ]

* 変換操作では、VM とそれぞれのディスクに対して各操作が実行され、適切な RAW 形式が生成されます。
+
image::shift-toolkit-174.png[変換ステップのダイアログ]

* 手動で VM を作成して、変換されたディスクを使用します。
+
** OpenShift の場合、tridentctl を使用してボリュームを PVC としてインポートし、インポートしたディスクを使用して VM を作成します。
** OLVM の場合は、ovirt エンジン URL にアクセスし、Shift ツールキットで変換された RAW ファイルを OS ディスクとして接続して新しい VM を作成します。適切なインターフェースを選択してください。
+
注: OLVM の場合、qcow2 ファイル形式も使用できます。この選択はブループリントの作成中に行うことができます。

+
image::shift-toolkit-175.png[変換プラン編集ステップのダイアログ]

+
注意: 変換された RAW ディスク イメージを VM で使用するには、OpenShift コンソール、OpenShift の YAML 経由の OC コマンド、または OLVM の OLVM REST API/UI を使用して VM を手動で作成し、ディスクを接続する必要があります。これに加えて、ネットワークも手動でマッピングする必要があります。

+
注: VM を手動で作成するときは、適切なブート タイプ (EFI または BIOS) が指定されていることを確認してください。




