---
sidebar: sidebar 
permalink: migration/shift-toolkit-migration.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary: Shift Toolkit を使用して、仮想化プラットフォーム間で VM を移行します。このプロセスには、VM の準備、ディスク形式の変換、ターゲット環境でのネットワーク設定の構成が含まれます。 
---
= Shift Toolkit を使用して VM を移行する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Shift Toolkit を使用して、仮想化プラットフォーム間で VM を移行します。このプロセスには、VM の準備、ディスク形式の変換、ターゲット環境でのネットワーク設定の構成が含まれます。



== サポートされている移行

Shift Toolkit は、次のハイパーバイザー間の双方向の移行をサポートすることで、マルチハイパーバイザー環境に柔軟性を提供します。

* link:shift-toolkit-migrate-esxi2hyperv.html["VMware ESXi から Microsoft Hyper-V へ"]
* link:shift-toolkit-migrate-hyperv2esxi.html["Microsoft Hyper-V から VMware ESXi へ"]
* link:shift-toolkit-migrate-esxi2olvm.html["VMware ESXi から Oracle Linux Virtualization Manager (OLVM) へ"]
* link:shift-toolkit-migrate-esxi2osv.html["VMware ESXi から Red Hat OpenShift Virtualization へ"]




== 移行ワークフロー

ブループリントを作成したら、移行プロセスを開始できます。移行中、Shift Toolkit は一連の手順を実行してディスク形式を変換し、ブループリントで定義されているターゲット ホスト上に仮想マシンを作成します。

Shift Toolkit は移行中に次の手順を実行します。

. ブループリント内のすべてのVMの既存のスナップショットを削除します
. ソースのブループリントの VM スナップショットをトリガーする
. ディスク変換前にボリュームスナップショットをトリガーする
. すべてのVMのVMDKをクローンしてVHDx形式に変換する
. ターゲットの保護グループ内のVMの電源をオンにします
. 各VMにネットワークを登録する
. VMware Tools を削除し、OS の種類に応じてトリガー スクリプトまたは cron ジョブを使用して IP アドレスを割り当てます。




== ネットワークのヒントと考慮事項

移行を計画するときは、次のネットワーク要件と動作を考慮してください。  Shift Toolkit はソース VM からネットワーク設定を自動的にコピーし、移行された VM に再適用しますが、インターフェイスの命名とネットワーク アダプタの構成は Windows システムと Linux システム間で異なる場合があります。

.一般的な要件
* 静的IPアドレスが利用可能であり、別のVMに割り当てられていないことを確認する


.Windows VM
* 準備スクリプトは、ネットワーク構成の詳細（IPアドレス空間、ゲートウェイアドレス、DNSサーバー）をコピーします。
* トリガースクリプトは、ブループリントマッピングに基づいて、単一または複数のNICの移行中にネットワーク設定を再適用します。
* 移行後、Windows デバイス マネージャーに移行前の古いネットワーク アダプター情報が表示されることがありますが、これは新しいアダプターには影響せず、IP の競合も発生しません。
* v4.0 にアップグレードすると、レジストリとデバイス マネージャーから孤立したネットワーク デバイスが自動的に削除されます。


.Linux VM
* 準備スクリプトは、ネットワーク構成の詳細（IPアドレス空間、ルート、DNSサーバー、ネットワークデバイス名）をコピーします。
* スクリプトはLinuxディストリビューションのネットワークタイプを識別し、それに応じてIP設定を適用します。
* ネットワーク再割り当てスクリプトはcrontabを使用してcronジョブとして設定され、起動時に実行されます。
* スクリプトはブループリントマッピングに基づいて単一または複数のNICのネットワーク設定を再適用します


.インターフェースの命名
* 変換されたVMのインターフェース名は次のようなものになる場合があります。 `eth0`または `ensp0`ソースインターフェース名の代わりに（例： `ens192`または `ens33`）
* スクリプトは、新しいインターフェース名に合わせてネットワーク構成の詳細を更新します。
* 予測可能な名前が適切なudevマッチングルールで使用され、インターフェース名がターゲットハイパーバイザー上で保持されている場合、スクリプトはネットワーク構成をスキップし、VMwareツールを削除してVMを再起動します。



NOTE: Shift Toolkit を使用すると、ネットワークの準備を上書きできるため、管理者は IP 割り当てやその他の構成用のカスタム スクリプトを実行できます。

.サポートされているネットワークメカニズム
* ネットワークマネージャー
* ネットプラン
* ifconfig
* 邪悪な


Shift Toolkit は、ブループリントで指定されたとおりに IP アドレスを保持します。



== 移行フェーズ

Shift Toolkit を使用して VM を移行する場合に従う移行フェーズは次のとおりです。

. *VM の準備*: 移行のために VM を準備し、すべての前提条件が完了していることを確認します。
. *移行と検証*: 準備が完了したら、VMware VM をターゲット ハイパーバイザーに移行します。
+
移行が完了したら、VM が正常に起動し、データが適切に移行されたことを確認します。

. *移行をテストする*: テスト移行では、VMDK を適切な形式に変換し、qtree 上の変換された仮想ディスク ファイルを使用して VM を作成することで、移行をシミュレートします。
+
テスト移行にはネットワーク マッピング構成が含まれないため、テスト ネットワークに対して手動で実行する必要があります。




NOTE: Shift Toolkit は、VM の準備に必要なスクリプトをコピーする以外は、ソース VM を変更しません。これにより、変換が失敗した場合に迅速なロールバックが可能になります。



== 移行を実行する

ブループリントで指定された構成で移行ワークフローをトリガーするには、[*移行*] をクリックします。

image::shift-toolkit-030.png[VM の移行をトリガーする方法を示すダイアログ]

開始されると、ワークフローがアクティブになり、変換プロセスは概説された手順に従って VM を登録します。ブループリント内の VM の電源がオフになっていない場合、Shift Toolkit は続行する前に正常なシャットダウンを要求します。

image::shift-toolkit-031.png[移行プロセスの確認]


NOTE: NetApp、同じソースから同じ宛先への変換を同時に 10 回以下しかトリガーしないことを推奨しています。

image::shift-toolkit-032.png[移行の進捗状況]

VMDK から任意のファイル形式への変換は数秒で完了するため、これが利用可能な最速のオプションとなります。このアプローチは、移行中の VM のダウンタイムを削減するのに役立ちます。

image::shift-toolkit-033.png[ディスク変換の進行状況]

ジョブが完了すると、ブループリントのステータスが「移行完了」に変わります。

image::shift-toolkit-034.png[移行完了ステータス]
