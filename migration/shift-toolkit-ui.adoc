---
sidebar: sidebar 
permalink: migration/shift-toolkit-ui.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= NetApp Shift Toolkit を構成する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
VM の移行または変換を自動化するように Shift Toolkit を構成します。このプロセスには、ソース サイトと宛先サイトの追加、ストレージの構成、VM のリソース グループへのグループ化、移行ブループリントの作成、移行のスケジュール設定が含まれます。



== 実行シフトツールキット

* ブラウザを使用してShiftツールキットUIにアクセスするには、 `http://<IP address specified during installation>:3001`
+

NOTE: 最適なエクスペリエンスを得るには、Google Chrome または Internet Explorer を使用してください。

* 以下のデフォルトの資格情報を使用して UI にアクセスします: ユーザー名: admin パスワード: admin
+
image::shift-toolkit-050.png[NetApp Shift Toolkit ログイン画面の図]

+

NOTE: 管理者は最初のログイン時に資格情報を変更する必要があります。

+

NOTE: 必須のパスワード変更後、GUI にログインした後、「パスワードの変更」オプションを使用して管理者の資格情報も変更できます。

+
image::shift-toolkit-051.png[NetApp Shift Toolkit のパスワード変更画面の図]

+
完了したら、「同意して続行」をクリックして法的EULAに同意します。

+
image::shift-toolkit-052.png[NetAppエンドユーザー使用許諾契約 (EULA) のスクリーンショット]





== Shiftツールキットの構成

ソース ハイパーバイザーと宛先ハイパーバイザーの両方へのストレージと接続が適切に構成されたら、 FlexClone機能を活用して仮想マシンの適切な形式への移行または変換を自動化するように Shift ツールキットの構成を開始します。



=== サイトを追加

最初のステップは、ソースとターゲットのハイパーバイザーの詳細 (ハイパーバイザーとストレージの両方) を検出して Shift ツールキットに追加することです。サポートされているブラウザで Shift ツールキットを開き、デフォルトのユーザー名とパスワードを使用して、「サイトの追加」をクリックします。

image::shift-toolkit-053.png[Shift Toolkit のサイト追加ダイアログのダイアログ]


NOTE: 検出オプションを使用してサイトを追加することもできます。

次のプラットフォームを追加します。



==== ソース

* ソースサイトの詳細
+
** サイト名 - サイトの名前を入力します
** ハイパーバイザー – ソースとしてVMwareまたはHyper-Vを選択
** サイトの場所 – デフォルトのオプションを選択
** コネクタ – デフォルトの選択を選択




入力したら、「続行」をクリックします。

image::shift-toolkit-054.png[Shift Toolkit の「新しいサイトの追加」ダイアログ]

* VMware を選択した場合は、ソース vCenter の詳細を入力します。
+
** エンドポイント - vCenter ServerのIPアドレスまたはFQDNを入力します
** ユーザー名 - vCenter にアクセスするためのユーザー名 (UPN 形式: username@domain.com)
** vCenter パスワード – リソースのインベントリを実行するために vCenter にアクセスするためのパスワード。
** vCenter SSL サムプリント（オプション）


* Hyper-V を選択した場合は、ソース Hyper-V の詳細を入力します。
+
** エンドポイント - スタンドアロン ホストまたはフェールオーバー クラスター エンドポイントの IP アドレスまたは FQDN を入力します。
** Hyper-V ユーザー名 - Hyper-V にアクセスするためのユーザー名 (ダウンレベル ログイン (ドメイン\ユーザー名) または UPN 形式)
** Hyper-V パスワード – リソースのインベントリを実行するために Hyper-V にアクセスするためのパスワード。
+
 Select “Accept Self signed certificate” and click Continue.


* ONTAPストレージシステムの認証情報


image::shift-toolkit-055.png[Shift Toolkit の「新しいサイトの追加」ダイアログ]

追加されると、Shift ツールキットは自動検出を実行し、関連するメタデータ情報とともに VM を表示します。Shift ツールキットは、VM で使用されるネットワークと vLAN を自動的に検出し、それらを入力します。


NOTE: ソース サイトに変更が加えられた場合は、必ず検出を実行して最新の情報を取得してください。これを行うには、サイト名の横にある 3 つのドットをクリックし、「サイトの検出」をクリックします。


NOTE: VM インベントリは 24 時間ごとに自動更新されます。

image::shift-toolkit-056.png[Shift Toolkit のダイアログ 新しいサイトを追加してサイトを検出します]

特定のソース ハイパーバイザーの検出データを表示するには、ダッシュボードに移動し、適切なサイト名に対して [VM リストの表示] をクリックします。このページには、VM インベントリと VM 属性が表示されます。

image::shift-toolkit-057.png[Shift Toolkitのダイアログで検出されたサイト]

次のステップは、宛先ハイパーバイザーを追加することです。追加するには、「新しいサイトの追加」をクリックし、「宛先」を選択します。



==== デスティネーション

image::shift-toolkit-058.png[Shift Toolkitの宛先サイト追加ダイアログのダイアログ]

* 目的地サイトの詳細
+
** サイト名 - サイトの名前を入力します
** ハイパーバイザー – 次のオプションから適切なターゲット プラットフォームを選択します。
+
*** VMware
*** Hyper-V
*** オープンシフト
*** OLVM
*** KVM（変換のみ）


** サイトの場所 – デフォルトのオプションを選択
** コネクタ – デフォルトの選択を選択




入力したら、「続行」をクリックします。

image::shift-toolkit-059.png[Shift Toolkit の宛先詳細のサイト追加ダイアログ]

ハイパーバイザーの選択に基づいて、必要な詳細を入力します。

* 宛先ハイパーバイザーの詳細
+
** それぞれのハイパーバイザーマネージャーのエンドポイントIPアドレスまたはFQDN
** ユーザー名 - アクセスするためのユーザー名 (UPN 形式: username@domain.com または domain\administrator) パスワード - リソースのインベントリを実行するためのアクセス用のパスワード。




「自己署名証明書を受け入れる」を選択します。

* 完了したら、「サイトを作成」をクリックします。



NOTE: ディスク形式の変換はボリューム レベルで同じボリューム内で行われるため、ソースと宛先のストレージ システムは同じである必要があります。

image::shift-toolkit-060.png[Shift Toolkit の宛先詳細のサイト追加ダイアログ]

次のステップでは、必要な VM をリソース グループとして移行グループにグループ化します。



=== リソースのグループ化

プラットフォームを追加したら、移行または変換する VM をリソース グループにグループ化します。  Shift ツールキットのリソース グループを使用すると、依存する VM のセットを、ブート順序とブート遅延を含む論理グループにグループ化できます。


NOTE: リソース グループを作成する前に、Qtree がプロビジョニングされていることを確認します (前提条件のセクションで説明されているとおり)。

リソース グループの作成を開始するには、「新しいリソース グループの作成」メニュー項目をクリックします。

. リソース グループにアクセスし、「新しいリソース グループの作成」をクリックします。
+
image::shift-toolkit-061.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

. 「新しいリソース グループ」で、ドロップダウンからソース サイトを選択し、「作成」をクリックします。
. リソース グループの詳細を指定し、ワークフローを選択します。ワークフローには2つのオプションがあります
+
.. クローンベースの移行 - ソースハイパーバイザーから宛先ハイパーバイザーへの VM のエンドツーエンドの移行を実行します。
.. クローンベースの変換 - 選択したハイパーバイザー タイプへのディスク フォーマットの変換を実行します。
+
image::shift-toolkit-062.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]



. 「続行」をクリックします
. 検索オプションを使用して適切な VM を選択します。デフォルトのフィルター オプションは「データストア」です。
+

NOTE: 変換前に、変換または移行する VM を、新しく作成されたONTAP SVM 上の指定されたデータストアに移動します。これにより、本番環境の NFS データストアを分離することができ、指定されたデータストアを仮想マシンのステージングに使用できるようになります。

+

NOTE: OpenShift 環境では、 ONTAP NAS ストレージ ドライバーを使用して PVC (永続ボリューム要求) 構造を複製するには、VMDK を対応するボリュームに再配置する必要があります。今後のリリースでは、 ONTAP NAS エコノミー ドライバーを活用するための追加の機能強化が組み込まれる予定です。

+
image::shift-toolkit-063.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

+

NOTE: このコンテキストのデータストア ドロップダウンには、NFSv3 データストアのみが表示されます。NFSv4 データストアは表示されません。

+
image::shift-toolkit-064.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

. 「宛先サイト」、「宛先ハイパーバイザー エントリ」、およびデータストアから Qtree またはストレージ クラスへのマッピングを選択して、移行の詳細を更新します。
+
image::shift-toolkit-065.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

+

NOTE: VM を変換するときに、宛先パス (変換された VM が保存される場所) が qtree に設定されていることを確認します。適切な qtree への宛先パスを設定します。

+

NOTE: 複数の qtree を作成し、それに応じて変換された VM ディスクを保存するために使用できます。

+

NOTE: 仮想マシンはスパンされたデータストア上で実行でき、Shit ツールキットはそれを自動的に検出しますが、ボリュームごとに qtree をマップする必要があります。

+
複数のボリュームにまたがるスパンされた VMDK を持つ VM を移行する機能 Shift ツールキット UI は、特定の RG に対して選択された VM または VM の一部であるすべてのスパンされたボリュームを自動的に選択します。これにより、データストアと qtree のマッピングを実行する RG ページ内のすべてのボリュームが一覧表示されます。

+
image::shift-toolkit-066.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

. 選択したすべての VM のブート順序とブート遅延 (秒) を選択します。各仮想マシンを選択し、その優先順位を設定することで、電源オンシーケンスの順序を設定します。3 はすべての仮想マシンのデフォルト値です。オプションは次のとおりです: 1 – 最初にパワーオンする仮想マシン 3 – デフォルト 5 – 最後にパワーオンする仮想マシン
+
image::shift-toolkit-067.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

. 「リソース グループの作成」をクリックします。
+
image::shift-toolkit-068.png[新しいリソース グループの作成ユーザー インターフェースのダイアログ]

+

NOTE: 仮想マシンを追加または削除するためにリソース グループを変更する必要がある場合は、リソース グループ名に対してこのオプションを使用し、「リソース グループの編集」を選択します。





=== 設計図

仮想マシンを移行または変換するには、計画が必要です。ドロップダウンからソースおよび宛先のハイパーバイザー プラットフォームを選択し、このブループリントに含めるリソース グループと、アプリケーションの電源をオンにする方法のグループ化 (ドメイン コントローラー、次に Tier-1、次に Tier-2 など) を選択します。これらは移行計画とも呼ばれることがあります。ブループリントを定義するには、「ブループリント」タブに移動し、「新しいブループリントの作成」をクリックします。

ブループリントの作成を開始するには、「新しいブループリントを作成」をクリックします。

. ブループリントにアクセスし、「新しいブループリントを作成」をクリックします。
+
image::shift-toolkit-069.png[Access Blueprints ユーザーインターフェースのダイアログ]

. 「新しいブループリント」で、プランの名前を指定し、ソース サイト > 関連する vCenter、宛先サイト、および関連するハイパーバイザーを選択して、必要なホスト マッピングを追加します。
. マッピングが完了したら、クラスターとホストのマッピングを選択します。以下の例では、Hyper-V がターゲットとして表示されています。表示されるハイパーバイザー オプションは、選択したソース サイトによって異なります。
+
image::shift-toolkit-070.png[新しいブループリントの作成ユーザーインターフェースのダイアログ]

. リソース グループの詳細を選択し、「続行」をクリックします。
+
image::shift-toolkit-071.png[新しいブループリントの作成ユーザーインターフェースのダイアログ]

. リソース グループの実行順序を設定します。このオプションを使用すると、複数のリソース グループが存在する場合に操作のシーケンスを選択できます。
. 前の手順を完了したら、[ネットワーク マッピング] を選択し、適切なネットワーク マップに割り当てます。仮想スイッチ、ネットワーク プロファイル、またはオペレーターがターゲット ハイパーバイザーにすでにプロビジョニングされていることを確認します。
+
image::shift-toolkit-072.png[新しいブループリントの作成ユーザーインターフェースのダイアログ]

+

NOTE: テスト移行の場合、「ネットワークを構成しない」がデフォルトで選択されており、Shift ツールキットは IP アドレスの割り当てを実行しません。ディスクが変換され、それぞれのハイパーバイザー側で仮想マシンが購入されたら、実稼働ネットワークとの衝突を避けるためにバブル ネットワーク スイッチを手動で割り当てます。

+
image::shift-toolkit-073.png[新しいブループリントの作成ユーザーインターフェースのダイアログ]

. VM の選択に基づいて、ストレージ マッピングが自動的に選択されます。
+

NOTE: 仮想マシンを作成してパワーオンできるように、qtree が事前にプロビジョニングされ、必要な権限が割り当てられていることを確認してください。注: OpenShift の場合、PVC はTrident CSI を使用して作成されるため、qtree を事前に作成する必要はありません。

. VM の詳細で、各 OS タイプに対してサービス アカウントと有効なユーザー資格情報を指定します。これは、仮想マシンに接続して、VMware ツールの削除や IP 構成の詳細のバックアップに必要な特定のスクリプトを作成および実行するために使用されます。
+
.. Windows ベースの OS の場合は、ローカル管理者権限を持つユーザーを使用することをお勧めします。ドメイン資格情報も使用できますが、変換前に VM にユーザー プロファイルが存在することを確認してください。そうでない場合、ネットワークが接続されていないときにドメイン認証が検索されるため、ドメイン資格情報は機能しません。
.. Linux ディストリビューション ベースのゲスト VM の場合、パスワードなしで sudo コマンドを実行できるユーザーを指定します。つまり、そのユーザーは sudoers リストの一部であるか、/etc/sudoers.d/ フォルダーに新しい構成ファイルとして追加されている必要があります。
+
image::shift-toolkit-074.png[新しいブループリントの作成ユーザーインターフェースのダイアログ]

+
最近のリリースでは、Shift Toolkit により仮想マシンの準備の柔軟性が向上しました。デフォルトでは、ツールキットはOS固有のスクリプトを展開してVMの準備を自動化し、次の操作を実行します。* VMware Toolsを削除する * 選択したブループリントに基づいて再割り当て用のIP設定をバックアップする

+
+ 新しい機能強化により、ユーザーはデフォルトの prepareVM タスクをオーバーライドできるようになり、IP 割り当てを含む手動の VM 準備用のカスタム スクリプトを実行できるようになりました。これにより、独自の構成やコンプライアンス要件を持つ環境をより細かく制御できるようになります。



. 再度、VM の詳細の下で、関連する IP 構成オプションを選択します。デフォルトでは、「構成しない」が選択されています。
+
.. ソース システムから同じ IP を持つ VM を移行するには、「IP を保持」を選択します。
.. ソース システムで静的 IP を使用して VM を移行し、ターゲット VM に DHCP を割り当てるには、「DHCP」を選択します。
+
この機能が動作するには、次の要件が満たされていることを確認してください。

+
*** 準備 VM フェーズ中およびスケジュールされた移行時間まで VM の電源がオンになっていることを確認します。
*** VMware VM の場合は、VMware Tools がインストールされていることを確認します。
*** ソース ハイパーバイザーとして Hyper-v を使用する場合は、統合サービスが有効になっていて構成されていることを確認します。
*** OLVM および OpenShift をターゲット ハイパーバイザーとして使用する場合は、virtIO ISO ファイルを Windows VM にマウントしてください。
*** cron ジョブを作成するには、Windows OS では管理者権限を持つアカウント、Linux ベースのディストリビューション OS ではパスワード オプションなしの sudo 権限を持つアカウントによって、ソース VM 上で準備スクリプトが実行されていることを確認します。




. 次のステップは VM の構成です。
+
** オプションで VM の CPU/RAM パラメータのサイズを変更します。これはサイズ変更に非常に役立ちます。
** ブート順序のオーバーライド: リソース グループ全体で選択されたすべての VM のブート順序とブート遅延 (秒) も変更します。これは、リソース グループのブート順序の選択時に選択した内容から変更が必要な場合に、ブート順序を変更するための追加オプションです。デフォルトでは、リソース グループの選択時に選択されたブート順序が使用されますが、この段階で変更を加えることができます。
** パワーオン: ワークフローで仮想マシンをパワーオンしない場合は、このオプションをオフにします。デフォルトのオプションは ON で、VM の電源がオンになることを意味します。
** VMware ツールを削除します。Shift ツールキットは、変換後に VMware ツールを削除します。このオプションはデフォルトで選択されています。顧客独自のカスタマイズされたスクリプトを実行する予定の場合は、これを選択しないでください。
** 世代: Shift ツールキットは次の経験則を使用して、適切なものをデフォルトに設定します (Gen1 > BIOS、Gen2 > EFI)。このオプションは選択できません。
** MAC を保持: それぞれの VM の MAC アドレスを保持することで、MAC に依存するアプリケーションのライセンスの課題を克服できます。
** サービス アカウントのオーバーライド: このオプションを使用すると、グローバル サービス アカウントを使用できない場合に別のサービス アカウントを指定できます。
+
image::shift-toolkit-075.png[リソース グループ ユーザー インターフェイスのダイアログ]



. 「続行」をクリックします。
. 次のステップでは、チェックボックスを選択して日時を設定し、移行をスケジュールします。予定日までにすべての仮想マシン (VM) が準備され、電源がオフになっていることを確認します。完了したら、「ブループリントを作成」をクリックします。
+
image::shift-toolkit-076.png[リソース グループ ユーザー インターフェイスのダイアログ]

+

NOTE: スケジュールを設定するときは、現在の Shift VM 時間より少なくとも 30 分先の日付を選択します。これは、ワークフローがリソース グループ内の VM を準備するのに十分な時間を確保するためです。

. ブループリントが作成されると、prepareVMジョブが開始され、移行の準備としてソースVM上でスクリプトが自動的に実行されます。
+
image::shift-toolkit-077.png[リソース グループ ユーザー インターフェイスのダイアログ]

+
このジョブは、invoke-VMScript メソッドを使用してスクリプトを実行し、VMware ツールを削除し、IP アドレス、ルート、DNS 情報などのネットワーク構成の詳細をバックアップするために必要なスクリプトをコピーします。これらのスクリプトは、ターゲット VM で同じ設定を維持するために使用されます。

+
.. Windows ベースのオペレーティング システムの場合、準備スクリプトが保存されるデフォルトの場所は「C:\ NetApp」フォルダーです。
+
image::shift-toolkit-078.png[リソース グループ ユーザー インターフェイスのダイアログ]

.. Linux ベースの VM の場合、準備スクリプトが保存されるデフォルトの場所は / NetAppと /opt ディレクトリです。
+
image::shift-toolkit-079.png[リソース グループ ユーザー インターフェイスのダイアログ]

+

NOTE: CentOS または Red Hat を実行している Linux ソース VM の場合、Shift ツールキットは必要な Hyper-V ドライバーを自動的にインストールするインテリジェントな機能を備えています。変換後に VM が正常に起動できるようにするには、ディスク変換前にこれらのドライバーがソース VM に存在している必要があります。

+

NOTE: 詳細については、link:https://access.redhat.com/solutions/3465011["RHEL VM を Hyper-V に移行した後、システムが Dracut で停止する"] 。

+
PrepareVM ジョブが正常に完了すると (下のスクリーンショットを参照)、VM の移行準備が整い、ブループリントのステータスが「アクティブ」に更新されます。

+
image::shift-toolkit-080.png[リソース グループ ユーザー インターフェイスのダイアログ]

+
image::shift-toolkit-081.png[リソース グループ ユーザー インターフェイスのダイアログ]

+
移行は設定された時間に実行されるか、「移行」オプションをクリックして手動で開始できます。




